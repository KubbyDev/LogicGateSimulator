<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Logic Gate Simulator</title>
    <link rel="stylesheet" type="text/css" href="Simulator/Style.css"/>
</head>
<body>

<canvas id="canvas" width="1400" height="700"></canvas>

<div id="popup_bg" onclick="Popup.closeIfClickedOnBackground()">
    <div id="popup_main_div">
        <!-- Filled by the program when needed -->
    </div>
</div>

<!-- This HTML went through Babel and javascript-minifier, so its not readable -->
<!-- for a human being. The readable version of the code can be found here: -->
<!-- https://github.com/KubbyDev/LogicGateSimulator/tree/master/Simulator -->
<script>
"use strict";var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),popupBackground=document.getElementById("popup_bg"),gates=[],framesToCalculate=-1;function fillCircle(t,e,i,n,o,r){ctx.beginPath(),ctx.fillStyle=n||"#ffffff",ctx.arc(t,e,i,0,2*Math.PI),ctx.fill(),(void 0===o||o)&&(ctx.lineWidth=1,ctx.strokeStyle=r||"#000000",ctx.stroke())}setTimeout(function(){Interface.init(),setInterval(function(){Interface.clear(),Interface.update(),0!==framesToCalculate&&Gate.updateAll(gates),framesToCalculate>0&&framesToCalculate--,Gate.drawAll(gates),Interface.draw()},1)},10);var circleRadius=5;function resizeCanvas(){canvas.width=window.innerWidth+1,setTimeout(function(){canvas.height=window.innerHeight+1},0)}function download(t,e){var i=new Blob([t],{type:"text/plain"}),n=window.document.createElement("a");n.href=window.URL.createObjectURL(i),n.download=e||"LogicGateSimulator",n.click()}function sqr(t){return t*t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}Array.prototype.remove=function(t){return this.filter(function(e){return e!==t})},Array.prototype.removeAll=function(t){return this.filter(function(e){return!t.includes(e)})},Array.prototype.includesByReference=function(t){var e=!0,i=!1,n=void 0;try{for(var o,r=this[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){if(o.value==t)return!0}}catch(t){i=!0,n=t}finally{try{e||null==r.return||r.return()}finally{if(i)throw n}}return!1},window.onresize=resizeCanvas,resizeCanvas();var connectionWidth=3,connectionDownColor="#d3d3d3",connectionUpColor="#ea120c",Connection=function(){function t(e,i){_classCallCheck(this,t),this.destination=i,this.origin=e}return _createClass(t,[{key:"getInput",value:function(){return this.destination instanceof ConnectionNode?this.destination.inputs[0]?this.destination.inputs[0].getInput():void 0:this.destination}},{key:"getValue",value:function(){return void 0!==this.getInput()&&this.getInput().output}},{key:"draw",value:function(t){var e=this.origin.getInputPosition(t),i=this.destination.getOutputPosition();ctx.beginPath(),ctx.moveTo(e[0],e[1]);var n=!0,o=!1,r=void 0;try{for(var a,s=this.calculateIntermediates(this.destination.x,this.destination.y,this.origin.x,e[1])[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;ctx.lineTo(u[0],u[1])}}catch(t){o=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw r}}ctx.lineTo(i[0],i[1]),ctx.lineWidth=connectionWidth,ctx.strokeStyle=this.getValue()?connectionUpColor:connectionDownColor,ctx.stroke()}},{key:"calculateIntermediates",value:function(t,e,i,n){var o=(i+t)/2,r=(n+e)/2;return i-this.origin.width/2-this.origin.width/6<t+this.destination.width/2+this.destination.width/6?[[i-this.origin.width/2-this.origin.width/6,n],[i-this.origin.width/2-this.origin.width/6,r],[t+this.destination.width/2+this.destination.width/6,r],[t+this.destination.width/2+this.destination.width/6,e]]:[[o,n],[o,e]]}}]),t}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Gate=function(){function t(){_classCallCheck(this,t),this.activation=function(){return!0},this.inputs=[],this.tempOutput=!1,this.output=!1,this.maxInputs=0,this.maxOutputs=1,this.id=-1,this.x=10,this.y=10,this.width=20,this.height=20,this.color="#379f1f",this.type="",this.name="",this.fontSize=8,this.hideName=!1}return _createClass(t,[{key:"setFonctionnalProperties",value:function(t,e,i,n){return e&&(this.activation=e),this.maxInputs=void 0!==n?n:0,this.setInputs(void 0!==i?i:[]),this.type=t,this}},{key:"setInputs",value:function(t){var e=this;return this.inputs=t.map(function(t){return new Connection(e,t)}).slice(0,this.maxInputs),this}},{key:"setHideName",value:function(t){return this.hideName=t,this}},{key:"addInput",value:function(t,e){void 0!==e&&e<this.maxInputs?this.inputs[e]=new Connection(this,t):this.inputs.length<this.maxInputs&&this.inputs.push(new Connection(this,t))}},{key:"update",value:function(){var t=this.inputs.map(function(t){return void 0!==t&&t.getValue()});this.tempOutput=this.activation(t)}},{key:"tickEnd",value:function(){this.output=this.tempOutput}},{key:"getConnector",value:function(t,e){if(t>this.x||this.maxInputs<1)return-1;for(var i=1/0,n=0,o=0;o<this.maxInputs;o++){var r=Math.abs(this.getInputPosition(o)[1]-e);r<i&&(n=o+1,i=r)}return n}},{key:"getGateForOutput",value:function(t){return this}},{key:"serializeParameters",value:function(){return""}},{key:"parseParameters",value:function(t){}},{key:"onClick",value:function(){}},{key:"createSave",value:function(){return{x:this.x,y:this.y,output:this.output,type:this.type,id:this.id}}},{key:"setGraphicProperties",value:function(t,e,i,n,o,r){return this.x=t,this.y=e,this.width=i*interfaceZoomFactor,this.height=n*interfaceZoomFactor,this.color=o,r&&(this.name=r),this.fontSize*=interfaceZoomFactor,this}},{key:"setPosition",value:function(t,e){return this.x=t,this.y=e,this}},{key:"draw",value:function(){this.drawBody(),this.hideName||(ctx.fillStyle="#ffffff",ctx.textAlign="center",ctx.textBaseline="middle",ctx.font=this.fontSize+"px Arial",ctx.fillText(this.name,this.x,this.y))}},{key:"drawBody",value:function(){ctx.fillStyle=this.color,ctx.fillRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height),ctx.strokeStyle="#000000",ctx.lineWidth=1,ctx.strokeRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height)}},{key:"getInputPosition",value:function(t){return[this.x-this.width/2+this.width/4,this.y-this.height/2+this.height*(t+1)/(this.maxInputs+1)]}},{key:"getOutputPosition",value:function(){return[this.x+this.width/2-connectionWidth,this.y]}}],[{key:"updateAll",value:function(t){var e=!0,i=!1,n=void 0;try{for(var o,r=t[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){o.value.update()}}catch(t){i=!0,n=t}finally{try{e||null==r.return||r.return()}finally{if(i)throw n}}var a=!0,s=!1,u=void 0;try{for(var c,l=t[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){c.value.tickEnd()}}catch(t){s=!0,u=t}finally{try{a||null==l.return||l.return()}finally{if(s)throw u}}}},{key:"removeAllConnectionsTo",value:function(t,e){var i=!0,n=!1,o=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done);i=!0)for(var s=r.value,u=0;u<s.inputs.length;u++)s.inputs[u]&&s.inputs[u].destination===t&&(s.inputs[u]=void 0)}catch(t){n=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(n)throw o}}}},{key:"drawAll",value:function(t){var e=!0,i=!1,n=void 0;try{for(var o,r=t[Symbol.iterator]();!(e=(o=r.next()).done);e=!0)for(var a=o.value,s=0;s<a.maxInputs;s++)a.inputs[s]&&a.inputs[s].draw(s)}catch(t){i=!0,n=t}finally{try{e||null==r.return||r.return()}finally{if(i)throw n}}var u=!0,c=!1,l=void 0;try{for(var h,f=t[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){h.value.draw()}}catch(t){c=!0,l=t}finally{try{u||null==f.return||f.return()}finally{if(c)throw l}}}}]),t}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}_defineProperty(Gate,"nextID",0);var GateFactory=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"UP",value:function(t,e){return(new Gate).setFonctionnalProperties("UP",function(){return!0},[]).setGraphicProperties(t,e,40,40,"#ae110b","1")}},{key:"DOWN",value:function(t,e){return(new Gate).setFonctionnalProperties("DOWN",function(){return!1},[]).setGraphicProperties(t,e,40,40,"#5f5f5f","0")}},{key:"NOT",value:function(t,e,i){var n=(new Gate).setFonctionnalProperties("NOT",function(t){return!t[0]},i,1).setGraphicProperties(t,e,30,20,"#379f1f");return n.drawBody=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/2,this.y-this.height/2),ctx.lineTo(this.x+this.width/2-2*circleRadius,this.y),ctx.lineTo(this.x-this.width/2,this.y+this.height/2),ctx.lineTo(this.x-this.width/2,this.y-this.height/2),ctx.fillStyle=this.color,ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#000000",ctx.stroke(),fillCircle(this.x+this.width/2-circleRadius,this.y,circleRadius)},n.hideName=!0,n}},{key:"AND",value:function(t,e,i){var n=(new Gate).setFonctionnalProperties("AND",function(t){return t[0]&&t[1]},i,2).setGraphicProperties(t,e,40,40,"#379f1f");return n.drawBody=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/2,this.y-this.height/2),ctx.lineTo(this.x+this.width/2-this.height/2,this.y-this.height/2),ctx.arc(this.x+this.width/2-this.height/2,this.y,this.height/2,-Math.PI/2,Math.PI/2),ctx.lineTo(this.x-this.width/2,this.y+this.height/2),ctx.lineTo(this.x-this.width/2,this.y-this.height/2),ctx.fillStyle=this.color,ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#000000",ctx.stroke()},n.hideName=!0,n}},{key:"OR",value:function(t,e,i){var n=(new Gate).setFonctionnalProperties("OR",function(t){return t[0]||t[1]},i,2).setGraphicProperties(t,e,40,40,"#379f1f");return n.drawBody=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/2,this.y+this.height/2),ctx.quadraticCurveTo(this.x-this.width/4,this.y,this.x-this.width/2,this.y-this.height/2),ctx.quadraticCurveTo(this.x+this.width/4,this.y-this.height/2,this.x+this.width/2,this.y),ctx.moveTo(this.x-this.width/2,this.y+this.height/2),ctx.quadraticCurveTo(this.x+this.width/4,this.y+this.height/2,this.x+this.width/2,this.y),ctx.fillStyle=this.color,ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#000000",ctx.stroke()},n.hideName=!0,n}},{key:"XOR",value:function(t,e,i){var n=(new Gate).setFonctionnalProperties("XOR",function(t){return t[0]!==t[1]},i,2).setGraphicProperties(t,e,45,40,"#379f1f");return n.drawBody=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/2+this.width/8,this.y+this.height/2),ctx.quadraticCurveTo(this.x-this.width/4+this.width/8,this.y,this.x-this.width/2+this.width/8,this.y-this.height/2),ctx.quadraticCurveTo(this.x+this.width/4,this.y-this.height/2,this.x+this.width/2,this.y),ctx.moveTo(this.x-this.width/2+this.width/8,this.y+this.height/2),ctx.quadraticCurveTo(this.x+this.width/4,this.y+this.height/2,this.x+this.width/2,this.y),ctx.fillStyle=this.color,ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#000000",ctx.stroke(),ctx.beginPath(),ctx.moveTo(this.x-this.width/2,this.y+this.height/2),ctx.quadraticCurveTo(this.x-this.width/4,this.y,this.x-this.width/2,this.y-this.height/2),ctx.lineWidth=3,ctx.strokeStyle="#000000",ctx.stroke()},n.hideName=!0,n}},{key:"NAND",value:function(t,e,i){var n=(new Gate).setFonctionnalProperties("NAND",function(t){return!(t[0]&&t[1])},i,2).setGraphicProperties(t,e,50,40,"#379f1f");return n.drawBody=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/2,this.y-this.height/2),ctx.lineTo(this.x+this.width/2-this.height/2-2*circleRadius,this.y-this.height/2),ctx.arc(this.x+this.width/2-this.height/2-2*circleRadius,this.y,this.height/2,-Math.PI/2,Math.PI/2),ctx.lineTo(this.x-this.width/2,this.y+this.height/2),ctx.lineTo(this.x-this.width/2,this.y-this.height/2),ctx.fillStyle=this.color,ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#000000",ctx.stroke(),fillCircle(this.x+this.width/2-circleRadius,this.y,circleRadius)},n.hideName=!0,n}},{key:"NOR",value:function(t,e,i){var n=(new Gate).setFonctionnalProperties("NOR",function(t){return!(t[0]||t[1])},i,2).setGraphicProperties(t,e,50,40,"#379f1f");return n.drawBody=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/2,this.y+this.height/2),ctx.quadraticCurveTo(this.x-this.width/4,this.y,this.x-this.width/2,this.y-this.height/2),ctx.quadraticCurveTo(this.x+this.width/4-2*circleRadius,this.y-this.height/2,this.x+this.width/2-2*circleRadius,this.y),ctx.moveTo(this.x-this.width/2,this.y+this.height/2),ctx.quadraticCurveTo(this.x+this.width/4-2*circleRadius,this.y+this.height/2,this.x+this.width/2-2*circleRadius,this.y),ctx.fillStyle=this.color,ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#000000",ctx.stroke(),fillCircle(this.x+this.width/2-circleRadius,this.y,circleRadius)},n.hideName=!0,n}},{key:"XNOR",value:function(t,e,i){var n=(new Gate).setFonctionnalProperties("XNOR",function(t){return t[0]===t[1]},i,2).setGraphicProperties(t,e,55,40,"#379f1f");return n.drawBody=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/2+this.width/8,this.y+this.height/2),ctx.quadraticCurveTo(this.x-this.width/4+this.width/8,this.y,this.x-this.width/2+this.width/8,this.y-this.height/2),ctx.quadraticCurveTo(this.x+this.width/4-2*circleRadius,this.y-this.height/2,this.x+this.width/2-2*circleRadius,this.y),ctx.moveTo(this.x-this.width/2+this.width/8,this.y+this.height/2),ctx.quadraticCurveTo(this.x+this.width/4-2*circleRadius,this.y+this.height/2,this.x+this.width/2-2*circleRadius,this.y),ctx.fillStyle=this.color,ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#000000",ctx.stroke(),ctx.beginPath(),ctx.moveTo(this.x-this.width/2,this.y+this.height/2),ctx.quadraticCurveTo(this.x-this.width/4,this.y,this.x-this.width/2,this.y-this.height/2),ctx.lineWidth=3,ctx.strokeStyle="#000000",ctx.stroke(),fillCircle(this.x+this.width/2-circleRadius,this.y,circleRadius)},n.hideName=!0,n}},{key:"INPUT",value:function(t,e){return(new Input).setFonctionnalProperties("INPUT").setGraphicProperties(t,e,40,40,"#db7ed2")}},{key:"CLOCK",value:function(t,e,i){return(new Clock).setPeriod(i).setFonctionnalProperties("CLOCK").setGraphicProperties(t,e,40,40,"#3d79e7")}},{key:"OUTPUT",value:function(t,e,i){return(new Output).setFonctionnalProperties("OUTPUT",function(t){return t[0]},i,1).setGraphicProperties(t,e,40,40,"#7a7a7a").setHideName(!0)}},{key:"NODE",value:function(t,e,i){return(new ConnectionNode).setFonctionnalProperties("NODE",function(t){return t[0]},i,1).setGraphicProperties(t,e,10,7,"#7a7a7a").setHideName(!0)}},{key:"SWITCH",value:function(t,e,i){return(new Switch).setFonctionnalProperties("SWITCH",function(t){return t[0]},i,1).setGraphicProperties(t,e,45,20,"#ffbb25")}}]),t}();function saveSimulatorState(t){var e={gates:[],interfaceZoomFactor:interfaceZoomFactor},i=!0,n=!1,o=void 0;try{for(var r,a=gates[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value,u=s.createSave();u.inputs=s.inputs.map(function(t){if(null==t)return null;var e=t.destination;if(e instanceof ConnectionNode){var i=e.findParentCustomGate();if(null!==i)return[i.gate.id,i.outputIndex]}return[e.id]}),e.gates.push(u)}}catch(t){n=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(n)throw o}}download(JSON.stringify(e),(t||"LogicGateSimulator")+".lgs")}function askForStateSave(){var t=window.document.createElement("INPUT");t.accept=".lgs",t.type="file",t.click(),t.addEventListener("change",function(){t.files[0]&&t.files[0].text().then(loadSimulatorState)})}function loadSimulatorState(t){var e=JSON.parse(t),i=Gate.nextID,n=e.gates.map(function(t){var n;"CUSTOM"===t.type?n=SerializerParser.parseCustomGate(t.string):n=(0,GateFactory[t.type])(0,0);return Object.assign(n,t),n.id+=i,n.x*=interfaceZoomFactor/e.interfaceZoomFactor,n.y*=interfaceZoomFactor/e.interfaceZoomFactor,n});function o(t,e){var i=n.find(function(e){return e.id===t});return void 0===e?i:i.outputGates[e]}var r=!0,a=!1,s=void 0;try{for(var u,c=n[Symbol.iterator]();!(r=(u=c.next()).done);r=!0){var l=u.value,h=l.inputs;l.inputs=[];for(var f=0;f<h.length;f++)if(null!==h[f]){var d=o(h[f][0]+i,h[f][1]);l.inputs[f]=new Connection(l,d)}}}catch(t){a=!0,s=t}finally{try{r||null==c.return||c.return()}finally{if(a)throw s}}Gate.nextID+=n.length,gates=gates.concat(n)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var clockOpenedPopup,SerializerParser=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"parseCustomGate",value:function(t){var e=new CustomGate;e.type="CUSTOM",e.string=t;for(var i=t.split(";"),n=i[1].split("&").filter(function(t){return""!==t}),o=0;o<n.length;o++){var r=new Gate;r.name=n[o],e.inputGates[o]=r}e.maxInputs=n.length;for(var a=i[2].split("&").filter(function(t){return""!==t}),s=0;s<a.length;s++){var u=a[s].split("§"),c=GateFactory.NODE(0,0);c.name=u[0],e.outputGates[s]=c}for(var l=i[3].split("&").filter(function(t){return""!==t}),h=0;h<l.length;h++){var f=l[h].split("§")[0].split("@");e.internGates[h]=GateFactory[f[0]](0,0),e.internGates[h].parseParameters(f)}function d(t,i){for(var n=1;n<i.length;n++)""!==i[n]&&(t.inputs[n-1]=new Connection(t,i[n]<e.maxInputs?e.inputGates[i[n]]:e.internGates[i[n]-e.maxInputs]))}for(var p=0;p<a.length;p++){var y=a[p].split("§").filter(function(t){return""!==t});d(e.outputGates[p],y)}for(var v=0;v<l.length;v++){var g=l[v].split("§").filter(function(t){return""!==t});d(e.internGates[v],g)}return e.maxOutputs=e.outputGates.length,e.setGraphicProperties(mouseX,mouseY,100,30+20*Math.max(e.maxInputs,e.maxOutputs),"#379f1f",i[0])}},{key:"serializeCustomGate",value:function(t,e,i){saveSimulatorState(t);var n="";function o(t){var e=!0,i=!1,n=void 0;try{for(var o,r=t.internGates.concat(t.outputGates)[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){for(var a=o.value,s=0;s<a.maxInputs;s++)if(void 0!==a.inputs[s]&&null!==a.inputs[s]){var u=t.inputGates.indexOf(a.inputs[s].destination);-1!==u&&(t.inputs[u]?a.inputs[s].destination=t.inputs[u].destination:a.inputs.splice(s,1))}gates.push(a)}}catch(t){i=!0,n=t}finally{try{e||null==r.return||r.return()}finally{if(i)throw n}}}function r(t,e){n[n.length-1]===t?n=n.substring(0,n.length-1)+e:n+=e}function a(t){for(var i=t instanceof Input,n=i?0:e.length,o=0;o<gates.length;o++){if(gates[o]===t)return n;i?gates[o]instanceof Input&&n++:gates[o]instanceof Output||gates[o]instanceof Input||n++}return-1}for(var s=gates.length,u=0;u<s;u++)gates[u]instanceof CustomGate&&o(gates[u]);gates=gates.filter(function(t){return!(t instanceof CustomGate)}).sort(function(t,e){return t.y-e.y}),n=t+";";var c=!0,l=!1,h=void 0;try{for(var f,d=e[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var p=f.value;n+=p+"&"}}catch(t){l=!0,h=t}finally{try{c||null==d.return||d.return()}finally{if(l)throw h}}r("&",";");var y=0,v=!0,g=!1,w=void 0;try{for(var m,x=gates[Symbol.iterator]();!(v=(m=x.next()).done);v=!0){var b=m.value;if(b instanceof Output){n+=i[y]+"§";var P=!0,C=!1,_=void 0;try{for(var O,k=b.inputs[Symbol.iterator]();!(P=(O=k.next()).done);P=!0){var S=O.value;n+=(S?a(S.destination):"NULL")+"§"}}catch(t){C=!0,_=t}finally{try{P||null==k.return||k.return()}finally{if(C)throw _}}y++,r("§","&")}}}catch(t){g=!0,w=t}finally{try{v||null==x.return||x.return()}finally{if(g)throw w}}r("&",";");var B=!0,G=!1,M=void 0;try{for(var T,I=gates[Symbol.iterator]();!(B=(T=I.next()).done);B=!0){var R=T.value;if(!(R instanceof Output||R instanceof Input)){n+=R.type+R.serializeParameters()+"§";var N=!0,E=!1,j=void 0;try{for(var F,D=R.inputs[Symbol.iterator]();!(N=(F=D.next()).done);N=!0){var L=F.value;n+=(L?a(L.destination):"NULL")+"§"}}catch(t){E=!0,j=t}finally{try{N||null==D.return||D.return()}finally{if(E)throw j}}y++,r("§","&")}}}catch(t){G=!0,M=t}finally{try{B||null==I.return||I.return()}finally{if(G)throw M}}return r("&",""),gates=[],n}}]),t}();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=_superPropBase(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Clock=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).period=50,t.current=0,t}return _inherits(e,Gate),_createClass(e,[{key:"update",value:function(){this.current--,this.current<0&&(this.current=this.period,this.tempOutput=!this.output)}},{key:"onClick",value:function(){Popup.open(),Popup.addTitle("Clock configuration"),Popup.addSpace(),Popup.addFields([{id:"clockPeriod",defaultValue:this.period}],"Period (milliseconds):"),Popup.addFields([{id:"clockCurrent",defaultValue:this.current}],"Current (milliseconds):"),Popup.addDoneButton(e.chooseParameters),clockOpenedPopup=this}},{key:"setPeriod",value:function(t,e){return this.period=t,e&&(this.current=e),this}},{key:"serializeParameters",value:function(){return"@".concat(this.period,"@").concat(this.current)}},{key:"parseParameters",value:function(t){this.period=t[1],this.current=t[2]}},{key:"createSave",value:function(){var t=_get(_getPrototypeOf(e.prototype),"createSave",this).call(this);return t.period=this.period,t.current=this.current,t}}],[{key:"chooseParameters",value:function(){var t=document.getElementById("clockPeriod").value;isNaN(t)||(clockOpenedPopup.period=t);var e=document.getElementById("clockCurrent").value;isNaN(e)||(clockOpenedPopup.current=e),Popup.close()}}]),e}();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=_superPropBase(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ConnectionNode=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).upColor="#ea120c",t.downColor="#7a7a7a",t}return _inherits(e,Gate),_createClass(e,[{key:"tickEnd",value:function(){_get(_getPrototypeOf(e.prototype),"tickEnd",this).call(this),this.color=this.output?this.upColor:this.downColor}},{key:"findParentCustomGate",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,o=gates[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var r=n.value;if(r instanceof CustomGate)for(var a=0;a<r.outputGates.length;a++)if(r.outputGates[a]==this)return{gate:r,outputIndex:a}}}catch(t){e=!0,i=t}finally{try{t||null==o.return||o.return()}finally{if(e)throw i}}return null}}]),e}();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=_superPropBase(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var CustomGate=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).internGates=[],t.inputGates=[],t.outputGates=[],t.string="",t}return _inherits(e,Gate),_createClass(e,[{key:"update",value:function(){for(var t=0;t<this.inputGates.length;t++)this.inputGates[t].output=this.inputs[t]&&this.inputs[t].getValue();var e=!0,i=!1,n=void 0;try{for(var o,r=this.internGates[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){o.value.update()}}catch(t){i=!0,n=t}finally{try{e||null==r.return||r.return()}finally{if(i)throw n}}}},{key:"tickEnd",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,o=this.internGates[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){n.value.tickEnd()}}catch(t){e=!0,i=t}finally{try{t||null==o.return||o.return()}finally{if(e)throw i}}}},{key:"getGateForOutput",value:function(t){return this.outputGates[t]}},{key:"getConnector",value:function(t,e){if(t>this.x||this.maxInputs<1){for(var i=1/0,n=0,o=0;o<this.outputGates.length;o++){var r=Math.abs(this.y-this.height/2+this.height*(o+1)/(this.outputGates.length+1)-e);r<i&&(n=o+1,i=r)}return-n}for(var a=1/0,s=0,u=0;u<this.maxInputs;u++){var c=Math.abs(this.getInputPosition(u)[1]-e);c<a&&(s=u+1,a=c)}return s}},{key:"onClick",value:function(){Popup.open(),Popup.addTitle("Custom Gate Information"),Popup.addSpace(),Popup.addText(this.string),Popup.addDoneButton(Popup.close)}},{key:"createSave",value:function(){var t=_get(_getPrototypeOf(e.prototype),"createSave",this).call(this);return t.string=this.string,t.maxInputs=this.maxInputs,t}},{key:"draw",value:function(){for(var t=0;t<this.outputGates.length;t++){var i=this.getOutputPosition(t);this.outputGates[t].x=i[0],this.outputGates[t].y=i[1]}_get(_getPrototypeOf(e.prototype),"draw",this).call(this),ctx.fillStyle="#ffffff",ctx.textAlign="center",ctx.textBaseline="middle",ctx.font=.8*this.fontSize+"px Arial";for(var n=0;n<this.outputGates.length;n++){var o=this.getOutputPosition(n);ctx.fillText(this.outputGates[n].name,o[0]-this.width/10,o[1])}for(var r=0;r<this.inputGates.length;r++){var a=this.getInputPosition(r);ctx.fillText(this.inputGates[r].name,a[0]-this.width/10,a[1])}}},{key:"getOutputPosition",value:function(t){return[this.x+this.width/2-connectionWidth,this.y-this.height/2+this.height*(t+1)/(this.outputGates.length+1)]}}],[{key:"openPopup",value:function(){Popup.open();var t=0,e=0,i=!0,n=!1,o=void 0;try{for(var r,a=gates[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value;s instanceof Input&&t++,s instanceof Output&&e++}}catch(t){n=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(n)throw o}}Popup.addTitle("Custom Gate Configuration"),Popup.addSpace(),Popup.addFields([{id:"name"}],"Gate name"),Popup.addSpace();for(var u=[],c=0;c<t;c++)u.push({id:"input"+c});u.length>0&&Popup.addFields(u,"Input names"),Popup.addSpace();for(var l=[],h=0;h<e;h++)l.push({id:"output"+h});u.length>0&&Popup.addFields(l,"Output names"),Popup.addSpace(),Popup.addDoneButton(function(){for(var i=[],n=0;n<t;n++)i[n]=document.getElementById("input"+n).value;for(var o=[],r=0;r<e;r++)o[r]=document.getElementById("output"+r).value;var a=SerializerParser.parseCustomGate(SerializerParser.serializeCustomGate(document.getElementById("name").value,i,o));BuildMode.addGate(a,!1),Popup.close(),a.onClick(),buildModeLastCustomGate=a.string})}}]),e}();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=_superPropBase(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Input=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).upColor="#ea120c",t.downColor="#7a7a7a",t.isOn=!0,t}return _inherits(e,Gate),_createClass(e,[{key:"update",value:function(){this.tempOutput=this.isOn}},{key:"onClick",value:function(){this.isOn=!this.isOn}},{key:"createSave",value:function(){var t=_get(_getPrototypeOf(e.prototype),"createSave",this).call(this);return t.isOn=this.isOn,t}},{key:"drawBody",value:function(){_get(_getPrototypeOf(e.prototype),"drawBody",this).call(this),ctx.fillStyle=this.isOn?this.upColor:this.downColor,ctx.fillRect(this.x-this.width/2+this.width/8,this.y-this.height/2+this.height/8,this.width-2*this.width/8,this.height-2*this.height/8)}}]),e}();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=_superPropBase(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Output=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).upColor="#ea120c",t.downColor="#7a7a7a",t}return _inherits(e,Gate),_createClass(e,[{key:"tickEnd",value:function(){_get(_getPrototypeOf(e.prototype),"tickEnd",this).call(this),this.color=this.output?this.upColor:this.downColor}},{key:"getConnector",value:function(t,e){return 1}}]),e}();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=_superPropBase(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Switch=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).isOn=!0,t}return _inherits(e,Gate),_createClass(e,[{key:"update",value:function(){this.isOn?_get(_getPrototypeOf(e.prototype),"update",this).call(this):this.tempOutput=!1}},{key:"onClick",value:function(){this.isOn=!this.isOn}},{key:"serializeParameters",value:function(){return"@"+(this.isOn?"1":"0")}},{key:"parseParameters",value:function(t){this.isOn="1"===t[1]}},{key:"createSave",value:function(){var t=_get(_getPrototypeOf(e.prototype),"createSave",this).call(this);return t.isOn=this.isOn,t}},{key:"drawBody",value:function(){_get(_getPrototypeOf(e.prototype),"drawBody",this).call(this),this.isOn||(ctx.fillStyle=interfaceBackgroundColor,ctx.fillRect(this.x-this.width/2+this.width/5,this.y-this.height/2,this.width-2*this.width/5,this.height))}}]),e}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var Button=function(){function t(){_classCallCheck(this,t),this.x=0,this.y=0,this.width=80,this.height=50,this.name="",this.color="#000000",this.fontSize=14}return _createClass(t,[{key:"setOnClick",value:function(t){return this.onClick=t,this}},{key:"onClick",value:function(){}},{key:"setGraphicProperties",value:function(t,e,i,n){return this.width=t,this.height=e,this.name=i,this.color=n,this}},{key:"draw",value:function(){ctx.fillStyle=this.color,ctx.fillRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height),ctx.fillStyle=interfaceBackgroundColor,ctx.fillRect(this.x-this.width/2+this.width/15,this.y-this.height/2+this.height/15,this.width-2*this.width/15,this.height-2*this.height/15),this.drawCenter()}},{key:"drawCenter",value:function(){this.drawName()}},{key:"drawName",value:function(){ctx.fillStyle="#ffffff",ctx.textAlign="center",ctx.textBaseline="middle",ctx.font=this.fontSize+"px Arial",ctx.fillText(this.name,this.x,this.y)}}]),t}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var interfaceBackgroundColor="#353535",interfaceButtonSpacing=5,interfaceZoomFactor=1,interfaceMode=0,interfaceBlockInputs=!1,interfaceButtons=[],Interface=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"clear",value:function(){ctx.fillStyle=interfaceBackgroundColor,ctx.fillRect(0,0,canvas.width,canvas.height)}},{key:"draw",value:function(){t.getCurrentMode().lateUpdate(),interfaceButtons[0].x=canvas.width/2-interfaceButtons[0].width-interfaceButtonSpacing,interfaceButtons[0].y=interfaceButtons[0].height/2+interfaceButtonSpacing,interfaceButtons[1].x=canvas.width/2,interfaceButtons[1].y=interfaceButtons[0].height/2+interfaceButtonSpacing,interfaceButtons[2].x=canvas.width/2+interfaceButtons[0].width+interfaceButtonSpacing,interfaceButtons[2].y=interfaceButtons[0].height/2+interfaceButtonSpacing,interfaceButtons[0].draw(),interfaceButtons[1].draw(),interfaceButtons[2].draw(),interfaceButtons[3].x=.5*interfaceButtons[3].width+interfaceButtonSpacing,interfaceButtons[3].y=.5*interfaceButtons[3].height+interfaceButtonSpacing,interfaceButtons[4].x=1.5*interfaceButtons[3].width+2*interfaceButtonSpacing,interfaceButtons[4].y=.5*interfaceButtons[3].height+interfaceButtonSpacing,interfaceButtons[3].draw(),interfaceButtons[4].draw(),interfaceButtons[5].x=.5*interfaceButtons[5].width+interfaceButtonSpacing,interfaceButtons[5].y=.5*interfaceButtons[5].height+interfaceButtons[3].height+2*interfaceButtonSpacing,interfaceButtons[5].draw(),0===framesToCalculate?(interfaceButtons[6].x=1.5*interfaceButtons[6].width+2*interfaceButtonSpacing,interfaceButtons[6].y=.5*interfaceButtons[6].height+interfaceButtons[4].height+2*interfaceButtonSpacing,interfaceButtons[6].draw()):(interfaceButtons[6].x=-1e3,interfaceButtons[6].y=-1e3)}},{key:"getButtonAtPosition",value:function(e,i){var n=!0,o=!1,r=void 0;try{for(var a,s=t.getCurrentMode().buttons.concat(interfaceButtons)[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;if(Math.abs(e-u.x)<u.width/2&&Math.abs(i-u.y)<u.height/2)return u}}catch(t){o=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw r}}return null}},{key:"init",value:function(){BuildMode.init(),WiringMode.init(),InteractionMode.init(),(interfaceButtons=[(new Button).setGraphicProperties(90,30,"Build","#ffffff").setOnClick(function(){return BuildMode.enable()}),(new Button).setGraphicProperties(90,30,"Wiring","#ffffff").setOnClick(function(){return WiringMode.enable()}),(new Button).setGraphicProperties(90,30,"Interaction","#ffffff").setOnClick(function(){return InteractionMode.enable()}),(new Button).setGraphicProperties(50,40,"Save","#00e1ff").setOnClick(function(){return saveSimulatorState()}),(new Button).setGraphicProperties(50,40,"Load","#00e1ff").setOnClick(function(){return askForStateSave()}),(new Button).setGraphicProperties(30,30,"","#ff9100").setOnClick(function(){return framesToCalculate=-!framesToCalculate}),(new Button).setGraphicProperties(30,30,"","#ff9100").setOnClick(function(){framesToCalculate>=0&&framesToCalculate++})])[5].drawCenter=function(){ctx.beginPath(),0===framesToCalculate?(ctx.moveTo(this.x-this.width/4,this.y-this.height/4),ctx.lineTo(this.x-this.width/4,this.y+this.height/4),ctx.lineTo(this.x+this.width/4,this.y)):(ctx.moveTo(this.x-this.width/10+this.width/6,this.y+this.height/4),ctx.lineTo(this.x-this.width/10+this.width/6,this.y-this.height/4),ctx.lineTo(this.x+this.width/10+this.width/6,this.y-this.height/4),ctx.lineTo(this.x+this.width/10+this.width/6,this.y+this.height/4),ctx.moveTo(this.x-this.width/10-this.width/6,this.y+this.height/4),ctx.lineTo(this.x-this.width/10-this.width/6,this.y-this.height/4),ctx.lineTo(this.x+this.width/10-this.width/6,this.y-this.height/4),ctx.lineTo(this.x+this.width/10-this.width/6,this.y+this.height/4)),ctx.fillStyle="#ff9100",ctx.fill()},interfaceButtons[6].drawCenter=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/20-this.width/6,this.y+this.height/4),ctx.lineTo(this.x-this.width/20-this.width/6,this.y-this.height/4),ctx.lineTo(this.x+this.width/20-this.width/6,this.y-this.height/4),ctx.lineTo(this.x+this.width/20-this.width/6,this.y+this.height/4),ctx.moveTo(this.x,this.y-this.height/4),ctx.lineTo(this.x,this.y+this.height/4),ctx.lineTo(this.x+this.width/4,this.y),ctx.fillStyle="#ff9100",ctx.fill()}}},{key:"update",value:function(){t.getCurrentMode().earlyUpdate()}},{key:"getCurrentMode",value:function(){switch(interfaceMode){case 0:return BuildMode;case 1:return WiringMode;case 2:return InteractionMode}}},{key:"zoom",value:function(t){interfaceZoomFactor*=t,circleRadius*=t,connectionWidth*=t;var e=!0,i=!1,n=void 0;try{for(var o,r=gates[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var a=o.value;a.width*=t,a.height*=t,a.x=(a.x-mouseX)*t+mouseX,a.y=(a.y-mouseY)*t+mouseY,a.fontSize*=t}}catch(t){i=!0,n=t}finally{try{e||null==r.return||r.return()}finally{if(i)throw n}}}}]),t}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var buildModeSelectedGate=null,buildModeSelectorPosition=0,buildModeListLength=0,buildModeButtons=[],buildModeLastCustomGate="",buildModeLastGate="",BuildMode=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"init",value:function(){(buildModeButtons=[(new Button).setGraphicProperties(80,50,"Destroy","#ae110b").setOnClick(function(){return t.removeGate(buildModeSelectedGate)}),(new Button).setGraphicProperties(80,30,"UP","#379f1f").setOnClick(function(){return buildModeSelectorPosition=Math.max(0,buildModeSelectorPosition-1)}),(new Button).setGraphicProperties(80,30,"DOWN","#379f1f").setOnClick(function(){return buildModeSelectorPosition=Math.min(buildModeButtons.length-buildModeListLength-5,buildModeSelectorPosition+1)}),(new Button).setGraphicProperties(150,60,"Create Custom Gate","#379f1f").setOnClick(function(){return CustomGate.openPopup()}),(new Button).setGraphicProperties(150,60,"Last Custom Gate","#379f1f").setOnClick(function(){return t.addGate(SerializerParser.parseCustomGate(buildModeLastCustomGate))}),(new Button).setGraphicProperties(80,80,"AND","#379f1f").setOnClick(function(){return t.addGate(GateFactory.AND(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"OR","#379f1f").setOnClick(function(){return t.addGate(GateFactory.OR(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"NOT","#379f1f").setOnClick(function(){return t.addGate(GateFactory.NOT(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"XOR","#379f1f").setOnClick(function(){return t.addGate(GateFactory.XOR(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"NOR","#379f1f").setOnClick(function(){return t.addGate(GateFactory.NOR(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"NAND","#379f1f").setOnClick(function(){return t.addGate(GateFactory.NAND(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"XNOR","#379f1f").setOnClick(function(){return t.addGate(GateFactory.XNOR(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"UP","#379f1f").setOnClick(function(){return t.addGate(GateFactory.UP(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"DOWN","#379f1f").setOnClick(function(){return t.addGate(GateFactory.DOWN(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"CLOCK","#379f1f").setOnClick(function(){return t.addGate(GateFactory.CLOCK(mouseX,mouseY,200))}),(new Button).setGraphicProperties(80,80,"INPUT","#379f1f").setOnClick(function(){return t.addGate(GateFactory.INPUT(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"OUTPUT","#379f1f").setOnClick(function(){return t.addGate(GateFactory.OUTPUT(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"SWITCH","#379f1f").setOnClick(function(){return t.addGate(GateFactory.SWITCH(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"NODE","#379f1f").setOnClick(function(){return t.addGate(GateFactory.NODE(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"CUSTOM","#379f1f").setOnClick(function(){return t.openCustomGatePopup()})])[1].drawCenter=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/8,this.y+this.height/8),ctx.lineTo(this.x+this.width/8,this.y+this.height/8),ctx.lineTo(this.x,this.y-this.height/8),ctx.moveTo(this.x-this.width/8,this.y-this.height/8),ctx.fillStyle="#379f1f",ctx.fill()},buildModeButtons[2].drawCenter=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/8,this.y-this.height/8),ctx.lineTo(this.x+this.width/8,this.y-this.height/8),ctx.lineTo(this.x,this.y+this.height/8),ctx.moveTo(this.x-this.width/8,this.y-this.height/8),ctx.fillStyle="#379f1f",ctx.fill()}}},{key:"enable",value:function(){interfaceMode=0,buildModeSelectedGate=null}},{key:"earlyUpdate",value:function(){buildModeSelectedGate&&(buildModeSelectedGate.x=mouseX,buildModeSelectedGate.y=mouseY)}},{key:"lateUpdate",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,o=buildModeButtons[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var r=n.value;r.x=-100,r.y=-100}}catch(t){e=!0,i=t}finally{try{t||null==o.return||o.return()}finally{if(e)throw i}}buildModeButtons[0].x=canvas.width-buildModeButtons[0].width/2-interfaceButtonSpacing,buildModeButtons[0].y=canvas.height-buildModeButtons[0].height/2-interfaceButtonSpacing,buildModeButtons[0].draw(),buildModeListLength=Math.floor((canvas.height-buildModeButtons[0].height-2*buildModeButtons[1].height-5*interfaceButtonSpacing)/(buildModeButtons[5].height+interfaceButtonSpacing)),buildModeButtons[1].x=canvas.width-buildModeButtons[1].width/2-interfaceButtonSpacing,buildModeButtons[1].y=buildModeButtons[1].height/2+interfaceButtonSpacing,buildModeButtons[2].x=canvas.width-buildModeButtons[2].width/2-interfaceButtonSpacing,buildModeButtons[2].y=buildModeButtons[5].height*buildModeListLength+1.5*buildModeButtons[1].height+interfaceButtonSpacing*(2+buildModeListLength),buildModeButtons[1].draw(),buildModeButtons[2].draw(),5+buildModeSelectorPosition+buildModeListLength-1>=buildModeButtons.length&&(buildModeSelectorPosition=buildModeButtons.length-buildModeListLength-5);for(var a=0;a<buildModeListLength&&!(buildModeSelectorPosition+a+5>buildModeButtons.length);a++)buildModeButtons[buildModeSelectorPosition+a+5].x=canvas.width-buildModeButtons[5].width/2-interfaceButtonSpacing,buildModeButtons[buildModeSelectorPosition+a+5].y=buildModeButtons[1].height+(a+.5)*buildModeButtons[5].height+(a+2)*interfaceButtonSpacing,buildModeButtons[buildModeSelectorPosition+a+5].draw();buildModeButtons[3].x=buildModeButtons[3].width/2+interfaceButtonSpacing,buildModeButtons[3].y=canvas.height-buildModeButtons[3].height/2-interfaceButtonSpacing,""!==buildModeLastCustomGate?(buildModeButtons[4].x=buildModeButtons[3].width+buildModeButtons[4].width/2+2*interfaceButtonSpacing,buildModeButtons[4].y=canvas.height-buildModeButtons[4].height/2-interfaceButtonSpacing,buildModeButtons[4].draw()):(buildModeButtons[4].x=-100,buildModeButtons[4].y=-100),buildModeButtons[3].draw()}},{key:"onClick",value:function(){buildModeSelectedGate=null!==buildModeSelectedGate?null:getGateAtPosition(mouseX,mouseY)}},{key:"onKeyPressed",value:function(e){if("Delete"===e&&t.removeGate(buildModeSelectedGate),"a"===e&&t.addGate(GateFactory.AND(mouseX,mouseY),!1),"o"===e&&t.addGate(GateFactory.OR(mouseX,mouseY),!1),"n"===e&&t.addGate(GateFactory.NOT(mouseX,mouseY),!1),"x"===e&&t.addGate(GateFactory.XOR(mouseX,mouseY),!1)," "===e)if("CUSTOM"===buildModeLastGate)t.addGate(SerializerParser.parseCustomGate(buildModeLastCustomGate),!1);else if(""!==buildModeLastGate){var i=GateFactory[buildModeLastGate];t.addGate(i(mouseX,mouseY),!1)}}},{key:"openCustomGatePopup",value:function(){Popup.open(),Popup.addTitle("Custom Gate"),Popup.addText("Data for your gate (you can generate it with the Build Custom Gate button)"),Popup.addFields([{id:"rawData"}]," "),Popup.addDoneButton(function(){var e=SerializerParser.parseCustomGate(document.getElementById("rawData").value);t.addGate(e),buildModeLastCustomGate=e.string,Popup.close()})}},{key:"addGate",value:function(t,e){(void 0===e||e)&&(buildModeSelectedGate=t),t.id=Gate.nextID,Gate.nextID++,buildModeLastGate=t.type,gates.push(t)}},{key:"removeGate",value:function(t){if(gates=gates.remove(t),buildModeSelectedGate=null,t instanceof CustomGate){var e=!0,i=!1,n=void 0;try{for(var o,r=t.outputGates[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var a=o.value;Gate.removeAllConnectionsTo(a,gates)}}catch(t){i=!0,n=t}finally{try{e||null==r.return||r.return()}finally{if(i)throw n}}}else Gate.removeAllConnectionsTo(t,gates)}},{key:"buttons",get:function(){return buildModeButtons}}]),t}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var wiringModeSelectedOutput,wiringModeSelectedInput,wiringModeInputIndex,wiringModeButtons,interactionModeButtons=[],InteractionMode=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"init",value:function(){interactionModeButtons=[]}},{key:"enable",value:function(){interfaceMode=2}},{key:"earlyUpdate",value:function(){}},{key:"lateUpdate",value:function(){}},{key:"onClick",value:function(){var t=getGateAtPosition(mouseX,mouseY);t&&t.onClick()}},{key:"onKeyPressed",value:function(t){}},{key:"buttons",get:function(){return interactionModeButtons}}]),t}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var wiringMode_AUTO_SNAP_RANGE=50,WiringMode=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"init",value:function(){wiringModeButtons=[]}},{key:"enable",value:function(){interfaceMode=1,wiringModeSelectedOutput=void 0,wiringModeSelectedInput=void 0}},{key:"earlyUpdate",value:function(){if(wiringModeSelectedOutput||wiringModeSelectedInput){var e=wiringModeSelectedInput?wiringModeSelectedInput.getInputPosition(wiringModeInputIndex):[wiringModeSelectedOutput.x+wiringModeSelectedOutput.width/2-connectionWidth,wiringModeSelectedOutput.y],i=t.findClosestConnectionSlot(void 0!==wiringModeSelectedOutput),n=void 0!==i?[i.x,i.y]:[mouseX,mouseY];ctx.beginPath(),ctx.strokeStyle="#d3d3d3",ctx.lineWidth=connectionWidth,ctx.moveTo(e[0],e[1]),ctx.lineTo(n[0],n[1]),ctx.stroke()}}},{key:"lateUpdate",value:function(){if(wiringModeSelectedOutput||wiringModeSelectedInput){var e=t.findClosestConnectionSlot(void 0!==wiringModeSelectedOutput);e&&fillCircle(e.x,e.y,10*interfaceZoomFactor,"rgba(255, 255, 255, 0.5)",!1)}else{var i=t.findClosestConnectionSlot();i&&fillCircle(i.x,i.y,10*interfaceZoomFactor,"rgba(255, 255, 255, 0.5)",!1)}}},{key:"onClick",value:function(){t.handleClick()}},{key:"onKeyPressed",value:function(t){}},{key:"findClosestConnectionSlot",value:function(t){var e=void 0,i=1/0;function n(t){var n=sqr(mouseX-t.x)+sqr(mouseY-t.y);n<sqr(wiringMode_AUTO_SNAP_RANGE*interfaceZoomFactor)&&n<i&&(i=n,e=t)}var o=!0,r=!1,a=void 0;try{for(var s,u=gates[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var c=s.value;if(void 0===t||t)for(var l=0;l<c.maxInputs;l++){var h=c.getInputPosition(l);n({x:h[0],y:h[1],gate:c,index:l,isInput:!0})}if(void 0===t||!t)for(var f=0;f<c.maxOutputs;f++){var d=c.getOutputPosition(f);n({x:d[0],y:d[1],gate:c,index:f,isInput:!1})}}}catch(t){r=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(r)throw a}}return e}},{key:"handleClick",value:function(){var e=void 0;wiringModeSelectedInput&&(e=!1),wiringModeSelectedOutput&&(e=!0);var i=t.findClosestConnectionSlot(e);return i?!wiringModeSelectedInput&&!wiringModeSelectedOutput&&i.isInput&&i.gate.inputs[i.index]?(wiringModeSelectedOutput=i.gate.inputs[i.index].destination,void(i.gate.inputs[i.index]=void 0)):(wiringModeSelectedOutput||i.isInput||(wiringModeSelectedOutput=i.gate.getGateForOutput(i.index)),!wiringModeSelectedInput&&i.isInput&&(wiringModeSelectedInput=i.gate,wiringModeInputIndex=i.index),void(wiringModeSelectedInput&&wiringModeSelectedOutput&&(wiringModeSelectedInput.addInput(wiringModeSelectedOutput,wiringModeInputIndex),wiringModeSelectedOutput=void 0,wiringModeSelectedInput=void 0))):(wiringModeSelectedOutput=void 0,void(wiringModeSelectedInput=void 0))}},{key:"buttons",get:function(){return wiringModeButtons}}]),t}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Popup=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"open",value:function(){t.containerDiv=document.createElement("DIV"),t.mainDiv.appendChild(t.containerDiv),popupBackground.style.display="block",interfaceBlockInputs=!0}},{key:"close",value:function(){t.containerDiv=void 0;for(var e=t.mainDiv.lastElementChild;e;)t.mainDiv.removeChild(e),e=t.mainDiv.lastElementChild;popupBackground.style.display="none",interfaceBlockInputs=!1}},{key:"closeIfClickedOnBackground",value:function(){mouseX>.1*canvas.width&&mouseX<.9*canvas.width&&mouseY>.1*canvas.height&&mouseY<.9*canvas.height||t.close()}},{key:"addFields",value:function(e,i){var n=t.containerDiv;if(i){var o=document.createElement("P");o.innerHTML=i+" ",o.classList.add("popupElementTitle"),t.containerDiv.appendChild(o),n=o}var r=!0,a=!1,s=void 0;try{for(var u,c=e[Symbol.iterator]();!(r=(u=c.next()).done);r=!0){var l=u.value,h=document.createElement("INPUT");l.id&&(h.id=l.id),h.value=l.defaultValue||"",h.classList.add("popupInput"),n.appendChild(h)}}catch(t){a=!0,s=t}finally{try{r||null==c.return||c.return()}finally{if(a)throw s}}}},{key:"addButtons",value:function(e,i){var n=t.containerDiv;if(i){var o=document.createElement("P");o.innerHTML=i,o.classList.add("popupElementTitle"),t.containerDiv.appendChild(o),n=o}var r=!0,a=!1,s=void 0;try{for(var u,c=e[Symbol.iterator]();!(r=(u=c.next()).done);r=!0){var l=u.value,h=document.createElement("BUTTON");h.innerHTML=l.title,h.addEventListener("click",l.clickEvent),h.classList.add("popupButton"),n.appendChild(h)}}catch(t){a=!0,s=t}finally{try{r||null==c.return||c.return()}finally{if(a)throw s}}}},{key:"addDoneButton",value:function(e){var i=document.createElement("BUTTON");i.innerHTML="Done",i.addEventListener("click",e),i.classList.add("popupDoneButton"),t.containerDiv.appendChild(i)}},{key:"addTitle",value:function(e){var i=document.createElement("HR");i.innerHTML=e,i.classList.add("popupTitle"),t.containerDiv.appendChild(i)}},{key:"addSpace",value:function(e){void 0===e&&(e=1);for(var i=0;i<e;i++)t.addText("<br>")}},{key:"addText",value:function(e){var i=document.createElement("P");i.innerHTML=e,i.classList.add("popupText"),t.containerDiv.appendChild(i)}}]),t}();_defineProperty(Popup,"mainDiv",document.getElementById("popup_main_div")),_defineProperty(Popup,"containerDiv",void 0);var mouseX=0,mouseY=0;function getGateAtPosition(t,e){var i=!0,n=!1,o=void 0;try{for(var r,a=gates[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var s=r.value;if(Math.abs(t-s.x)<s.width/2&&Math.abs(e-s.y)<s.height/2)return s}}catch(t){n=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(n)throw o}}return null}document.addEventListener("mousemove",function(t){mouseX=t.clientX-canvas.offsetLeft,mouseY=t.clientY-canvas.offsetTop}),document.addEventListener("click",function(){if(!interfaceBlockInputs){var t=Interface.getButtonAtPosition(mouseX,mouseY);t?t.onClick():Interface.getCurrentMode().onClick()}}),document.onkeydown=function(t){switch(t.key){case"Escape":Popup.close()}if(!interfaceBlockInputs){switch(t.key){case"b":BuildMode.enable();break;case"w":WiringMode.enable();break;case"i":InteractionMode.enable()}Interface.getCurrentMode().onKeyPressed(t.key)}},canvas.addEventListener("wheel",function(t){interfaceBlockInputs||Interface.zoom(1-t.deltaY/1e3)});
</script>

</body>
</html>
