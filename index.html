<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Logic Gate Simulator</title>
    <link rel="stylesheet" type="text/css" href="Simulator/Style.css"/>
</head>
<body>

<canvas id="canvas" width="1400" height="700"></canvas>

<div id="popup_bg" onclick="Popup.closeIfClickedOnBackground()">
    <div id="popup_main_div">
        <!-- Filled by the program when needed -->
    </div>
</div>

<!-- This HTML went through Babel and javascript-minifier, so its not readable -->
<!-- for a human being. The readable version of the code can be found here: -->
<!-- https://github.com/KubbyDev/LogicGateSimulator/tree/master/Simulator -->
<script>
"use strict"; var canvas=document.getElementById("canvas");var ctx=canvas.getContext("2d");var popupBackground=document.getElementById("popup_bg");var gates=[];var framesToCalculate=-1;setTimeout(function(){Interface.init();setInterval(function(){Interface.clear();Interface.update();if(framesToCalculate!==0)Gate.updateAll(gates);if(framesToCalculate>0)framesToCalculate--;Gate.drawAll(gates);Interface.draw()},1)},100);"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var Tools=function(){function Tools(){_classCallCheck(this,Tools)}_createClass(Tools,null,[{key:"fillCircle",value:function fillCircle(x,y,radius,fillColor,drawBounds,boundsColor){ctx.beginPath();ctx.fillStyle=fillColor||"#ffffff";ctx.arc(x,y,radius,0,2*Math.PI);ctx.fill();if(drawBounds===undefined||drawBounds){ctx.lineWidth=1;ctx.strokeStyle=boundsColor||"#000000";ctx.stroke()}}},{key:"resizeCanvas",value:function resizeCanvas(){canvas.width=window.innerWidth+1;setTimeout(function(){canvas.height=window.innerHeight+1},0)}},{key:"download",value:function download(data,filename){var blob=new Blob([data],{type:"text/plain"});var elem=window.document.createElement("a");elem.href=window.URL.createObjectURL(blob);elem.download=filename||"LogicGateSimulator";elem.click()}},{key:"sqr",value:function sqr(x){return x*x}},{key:"getGateAtPosition",value:function getGateAtPosition(x,y){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=gates[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var gate=_step.value;if(Math.abs(x-gate.x)<gate.width/2&&Math.abs(y-gate.y)<gate.height/2)return gate}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}return null}}]);return Tools}();Array.prototype.remove=function(value){return this.filter(function(e){return e!==value})};Array.prototype.removeAll=function(values){return this.filter(function(e){return!values.includes(e)})};Array.prototype.includesByReference=function(value){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var element=_step2.value;if(element==value)return true}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]!=null){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return false};window.onresize=Tools.resizeCanvas;Tools.resizeCanvas();"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var Connection=function(){function Connection(origin,destination){_classCallCheck(this,Connection);this.destination=destination;this.origin=origin;}_createClass(Connection,[{key:"getInput",value:function getInput(){if(this.destination instanceof ConnectionNode){if(this.destination.inputs[0])return this.destination.inputs[0].getInput();else return undefined}return this.destination}},{key:"getValue",value:function getValue(){return this.getInput()!==undefined&&this.getInput().output}},{key:"draw",value:function draw(i){var inputPosition=this.origin.getInputPosition(i);var outputPosition=this.destination.getOutputPosition();ctx.beginPath();ctx.moveTo(inputPosition[0],inputPosition[1]);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.calculateIntermediates(this.destination.x,this.destination.y,this.origin.x,inputPosition[1])[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var point=_step.value;ctx.lineTo(point[0],point[1])}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}ctx.lineTo(outputPosition[0],outputPosition[1]);ctx.lineWidth=Interface.connectionWidth;ctx.strokeStyle=this.getValue()?Connection.upColor:Connection.downColor;ctx.stroke()}},{key:"calculateIntermediates",value:function calculateIntermediates(fromX,fromY,toX,toY){var averageX=(toX+fromX)/2;var averageY=(toY+fromY)/2;if(toX-this.origin.width/2-this.origin.width/6<fromX+this.destination.width/2+this.destination.width/6)return[[toX-this.origin.width/2-this.origin.width/6,toY],[toX-this.origin.width/2-this.origin.width/6,averageY],[fromX+this.destination.width/2+this.destination.width/6,averageY],[fromX+this.destination.width/2+this.destination.width/6,fromY]];else return[[averageX,toY],[averageX,fromY]]}}]);return Connection}();_defineProperty(Connection,"downColor","#d3d3d3");_defineProperty(Connection,"upColor","#ea120c");"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var Gate=function(){ function Gate(){_classCallCheck(this,Gate);this.activation=function(){return true};this.inputs=[];this.tempOutput=false;this.output=false;this.maxInputs=0;this.maxOutputs=1;this.id=-1;this.x=10;this.y=10;this.width=20;this.height=20;this.color="#379f1f";this.type="";this.name="";this.fontSize=8;this.hideName=false;}_createClass(Gate,[{key:"setFonctionnalProperties",value:function setFonctionnalProperties(type,activation,inputs,maxInputs){if(activation)this.activation=activation;this.maxInputs=maxInputs!==undefined?maxInputs:0;this.setInputs(inputs!==undefined?inputs:[]);this.type=type;return this}},{key:"setInputs",value:function setInputs(inputGates){var _this=this;this.inputs=inputGates.map(function(inputGate){return new Connection(_this,inputGate)}).slice(0,this.maxInputs);return this}},{key:"setHideName",value:function setHideName(hideName){this.hideName=hideName;return this}},{key:"addInput",value:function addInput(gate,index){if(index!==undefined&&index<this.maxInputs)this.inputs[index]=new Connection(this,gate);else if(this.inputs.length<this.maxInputs)this.inputs.push(new Connection(this,gate))}},{key:"update",value:function update(){var inputs=this.inputs.map(function(connection){return connection!==undefined&&connection.getValue()});this.tempOutput=this.activation(inputs)}},{key:"tickEnd",value:function tickEnd(){this.output=this.tempOutput}},{key:"getGateForOutput",value:function getGateForOutput(index){return this}},{key:"serializeParameters",value:function serializeParameters(){return""}},{key:"parseParameters",value:function parseParameters(parameters){}},{key:"onClick",value:function onClick(){}},{key:"createSave",value:function createSave(){return{x:this.x,y:this.y,output:this.output,type:this.type,id:this.id}}},{key:"setGraphicProperties",value:function setGraphicProperties(x,y,width,height,color,name){this.x=x;this.y=y;this.width=width*Interface.zoomFactor;this.height=height*Interface.zoomFactor;this.color=color;if(name)this.name=name;this.fontSize*=Interface.zoomFactor;return this}},{key:"setPosition",value:function setPosition(x,y){this.x=x;this.y=y;return this}},{key:"draw",value:function draw(){this.drawBody();if(!this.hideName){ctx.fillStyle="#ffffff";ctx.textAlign="center";ctx.textBaseline="middle";ctx.font=this.fontSize+"px Arial";ctx.fillText(this.name,this.x,this.y)}}},{key:"drawBody",value:function drawBody(){ctx.fillStyle=this.color;ctx.fillRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height);ctx.strokeStyle="#000000";ctx.lineWidth=1;ctx.strokeRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height)}},{key:"getInputPosition",value:function getInputPosition(index){return[this.x-this.width/2+this.width/4,this.y-this.height/2+this.height*(index+1)/(this.maxInputs+1)]}},{key:"getOutputPosition",value:function getOutputPosition(){return[this.x+this.width/2-Interface.connectionWidth,this.y]}}],[{key:"updateAll",value:function updateAll(gates){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=gates[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var gate=_step.value;gate.update()}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=gates[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _gate=_step2.value;_gate.tickEnd()}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]!=null){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"removeAllConnectionsTo",value:function removeAllConnectionsTo(gate,allGates){var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=allGates[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var g=_step3.value;for(var i=0;i<g.inputs.length;i++){if(g.inputs[i]&&g.inputs[i].destination===gate)g.inputs[i]=undefined}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]!=null){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}},{key:"drawAll",value:function drawAll(gates){var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=gates[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var gate=_step4.value;for(var i=0;i<gate.maxInputs;i++){if(gate.inputs[i])gate.inputs[i].draw(i)}}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4["return"]!=null){_iterator4["return"]()}}finally{if(_didIteratorError4){throw _iteratorError4}}}var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=gates[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var _gate2=_step5.value;_gate2.draw()}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5["return"]!=null){_iterator5["return"]()}}finally{if(_didIteratorError5){throw _iteratorError5}}}}}]);return Gate}();_defineProperty(Gate,"nextID",0);"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var GateFactory=function(){function GateFactory(){_classCallCheck(this,GateFactory)}_createClass(GateFactory,null,[{key:"UP",value:function UP(x,y){return new Gate().setFonctionnalProperties("UP",function(){return true},[]).setGraphicProperties(x,y,40,40,"#ae110b")}},{key:"DOWN",value:function DOWN(x,y){return new Gate().setFonctionnalProperties("DOWN",function(){return false},[]).setGraphicProperties(x,y,40,40,"#5f5f5f")}},{key:"NOT",value:function NOT(x,y,input){var g=new Gate().setFonctionnalProperties("NOT",function(i){return!i[0]},input,1).setGraphicProperties(x,y,30,20,"#379f1f");g.drawBody=function(){ctx.beginPath();ctx.moveTo(this.x-this.width/2,this.y-this.height/2);ctx.lineTo(this.x+this.width/2-Interface.negCircleR*2,this.y);ctx.lineTo(this.x-this.width/2,this.y+this.height/2);ctx.lineTo(this.x-this.width/2,this.y-this.height/2);ctx.fillStyle=this.color;ctx.fill();ctx.lineWidth=1;ctx.strokeStyle="#000000";ctx.stroke();Tools.fillCircle(this.x+this.width/2-Interface.negCircleR,this.y,Interface.negCircleR)};g.hideName=true;return g}},{key:"AND",value:function AND(x,y,inputs){var g=new Gate().setFonctionnalProperties("AND",function(i){return i[0]&&i[1]},inputs,2).setGraphicProperties(x,y,40,40,"#379f1f");g.drawBody=function(){ctx.beginPath();ctx.moveTo(this.x-this.width/2,this.y-this.height/2);ctx.lineTo(this.x+this.width/2-this.height/2,this.y-this.height/2);ctx.arc(this.x+this.width/2-this.height/2,this.y,this.height/2,-Math.PI/2,Math.PI/2);ctx.lineTo(this.x-this.width/2,this.y+this.height/2);ctx.lineTo(this.x-this.width/2,this.y-this.height/2);ctx.fillStyle=this.color;ctx.fill();ctx.lineWidth=1;ctx.strokeStyle="#000000";ctx.stroke()};g.hideName=true;return g}},{key:"OR",value:function OR(x,y,inputs){var g=new Gate().setFonctionnalProperties("OR",function(i){return i[0]||i[1]},inputs,2).setGraphicProperties(x,y,40,40,"#379f1f");g.drawBody=function(){ctx.beginPath();ctx.moveTo(this.x-this.width/2,this.y+this.height/2);ctx.quadraticCurveTo(this.x-this.width/4,this.y,this.x-this.width/2,this.y-this.height/2);ctx.quadraticCurveTo(this.x+this.width/4,this.y-this.height/2,this.x+this.width/2,this.y);ctx.moveTo(this.x-this.width/2,this.y+this.height/2);ctx.quadraticCurveTo(this.x+this.width/4,this.y+this.height/2,this.x+this.width/2,this.y);ctx.fillStyle=this.color;ctx.fill();ctx.lineWidth=1;ctx.strokeStyle="#000000";ctx.stroke()};g.hideName=true;return g}},{key:"XOR",value:function XOR(x,y,inputs){var g=new Gate().setFonctionnalProperties("XOR",function(i){return i[0]!==i[1]},inputs,2).setGraphicProperties(x,y,45,40,"#379f1f");g.drawBody=function(){ctx.beginPath();ctx.moveTo(this.x-this.width/2+this.width/8,this.y+this.height/2);ctx.quadraticCurveTo(this.x-this.width/4+this.width/8,this.y,this.x-this.width/2+this.width/8,this.y-this.height/2);ctx.quadraticCurveTo(this.x+this.width/4,this.y-this.height/2,this.x+this.width/2,this.y);ctx.moveTo(this.x-this.width/2+this.width/8,this.y+this.height/2);ctx.quadraticCurveTo(this.x+this.width/4,this.y+this.height/2,this.x+this.width/2,this.y);ctx.fillStyle=this.color;ctx.fill();ctx.lineWidth=1;ctx.strokeStyle="#000000";ctx.stroke();ctx.beginPath();ctx.moveTo(this.x-this.width/2,this.y+this.height/2);ctx.quadraticCurveTo(this.x-this.width/4,this.y,this.x-this.width/2,this.y-this.height/2);ctx.lineWidth=3;ctx.strokeStyle="#000000";ctx.stroke()};g.hideName=true;return g}},{key:"NAND",value:function NAND(x,y,inputs){var g=new Gate().setFonctionnalProperties("NAND",function(i){return!(i[0]&&i[1])},inputs,2).setGraphicProperties(x,y,50,40,"#379f1f");g.drawBody=function(){ctx.beginPath();ctx.moveTo(this.x-this.width/2,this.y-this.height/2);ctx.lineTo(this.x+this.width/2-this.height/2-Interface.negCircleR*2,this.y-this.height/2);ctx.arc(this.x+this.width/2-this.height/2-Interface.negCircleR*2,this.y,this.height/2,-Math.PI/2,Math.PI/2);ctx.lineTo(this.x-this.width/2,this.y+this.height/2);ctx.lineTo(this.x-this.width/2,this.y-this.height/2);ctx.fillStyle=this.color;ctx.fill();ctx.lineWidth=1;ctx.strokeStyle="#000000";ctx.stroke();Tools.fillCircle(this.x+this.width/2-Interface.negCircleR,this.y,Interface.negCircleR)};g.hideName=true;return g}},{key:"NOR",value:function NOR(x,y,inputs){var g=new Gate().setFonctionnalProperties("NOR",function(i){return!(i[0]||i[1])},inputs,2).setGraphicProperties(x,y,50,40,"#379f1f");g.drawBody=function(){ctx.beginPath();ctx.moveTo(this.x-this.width/2,this.y+this.height/2);ctx.quadraticCurveTo(this.x-this.width/4,this.y,this.x-this.width/2,this.y-this.height/2);ctx.quadraticCurveTo(this.x+this.width/4-2*Interface.negCircleR,this.y-this.height/2,this.x+this.width/2-2*Interface.negCircleR,this.y);ctx.moveTo(this.x-this.width/2,this.y+this.height/2);ctx.quadraticCurveTo(this.x+this.width/4-2*Interface.negCircleR,this.y+this.height/2,this.x+this.width/2-2*Interface.negCircleR,this.y);ctx.fillStyle=this.color;ctx.fill();ctx.lineWidth=1;ctx.strokeStyle="#000000";ctx.stroke();Tools.fillCircle(this.x+this.width/2-Interface.negCircleR,this.y,Interface.negCircleR)};g.hideName=true;return g}},{key:"XNOR",value:function XNOR(x,y,inputs){var g=new Gate().setFonctionnalProperties("XNOR",function(i){return i[0]===i[1]},inputs,2).setGraphicProperties(x,y,55,40,"#379f1f");g.drawBody=function(){ctx.beginPath();ctx.moveTo(this.x-this.width/2+this.width/8,this.y+this.height/2);ctx.quadraticCurveTo(this.x-this.width/4+this.width/8,this.y,this.x-this.width/2+this.width/8,this.y-this.height/2);ctx.quadraticCurveTo(this.x+this.width/4-2*Interface.negCircleR,this.y-this.height/2,this.x+this.width/2-2*Interface.negCircleR,this.y);ctx.moveTo(this.x-this.width/2+this.width/8,this.y+this.height/2);ctx.quadraticCurveTo(this.x+this.width/4-2*Interface.negCircleR,this.y+this.height/2,this.x+this.width/2-2*Interface.negCircleR,this.y);ctx.fillStyle=this.color;ctx.fill();ctx.lineWidth=1;ctx.strokeStyle="#000000";ctx.stroke();ctx.beginPath();ctx.moveTo(this.x-this.width/2,this.y+this.height/2);ctx.quadraticCurveTo(this.x-this.width/4,this.y,this.x-this.width/2,this.y-this.height/2);ctx.lineWidth=3;ctx.strokeStyle="#000000";ctx.stroke();Tools.fillCircle(this.x+this.width/2-Interface.negCircleR,this.y,Interface.negCircleR)};g.hideName=true;return g}},{key:"INPUT",value:function INPUT(x,y){return new Input().setFonctionnalProperties("INPUT").setGraphicProperties(x,y,40,40,"#db7ed2")}},{key:"CLOCK",value:function CLOCK(x,y,period){return new Clock().setPeriod(period).setFonctionnalProperties("CLOCK").setGraphicProperties(x,y,40,40,"#3d79e7")}},{key:"OUTPUT",value:function OUTPUT(x,y,input){return new Output().setFonctionnalProperties("OUTPUT",function(i){return i[0]},input,1).setGraphicProperties(x,y,40,40,"#7a7a7a").setHideName(true)}},{key:"NODE",value:function NODE(x,y,input){return new ConnectionNode().setFonctionnalProperties("NODE",function(i){return i[0]},input,1).setGraphicProperties(x,y,10,7,"#7a7a7a").setHideName(true)}},{key:"SWITCH",value:function SWITCH(x,y,input){return new Switch().setFonctionnalProperties("SWITCH",function(i){return i[0]},input,1).setGraphicProperties(x,y,45,20,"#ffbb25")}}]);return GateFactory}();"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var SerializerParser=function(){function SerializerParser(){_classCallCheck(this,SerializerParser)}_createClass(SerializerParser,null,[{key:"parseCustomGate",value:function parseCustomGate(rawData){var customGate=new CustomGate;customGate.type="CUSTOM";customGate.string=rawData;var parts=rawData.split(";");var inputsData=parts[1].split("&").filter(function(data){return data!==""});for(var i=0;i<inputsData.length;i++){var input=new Gate;input.name=inputsData[i];customGate.inputGates[i]=input}customGate.maxInputs=inputsData.length;var outputsData=parts[2].split("&").filter(function(data){return data!==""});for(var _i=0;_i<outputsData.length;_i++){var data=outputsData[_i].split("\xA7");var output=GateFactory.NODE(0,0);output.name=data[0];output.width=0;customGate.outputGates[_i]=output}var gatesData=parts[3].split("&").filter(function(data){return data!==""});for(var _i2=0;_i2<gatesData.length;_i2++){var gateParameters=gatesData[_i2].split("\xA7")[0].split("@");customGate.internGates[_i2]=GateFactory[gateParameters[0]](0,0);customGate.internGates[_i2].parseParameters(gateParameters)}function connect(gate,data){for(var _i3=1;_i3<data.length;_i3++){if(data[_i3]!=="")gate.inputs[_i3-1]=new Connection(gate,data[_i3]<customGate.maxInputs?customGate.inputGates[data[_i3]]:customGate.internGates[data[_i3]-customGate.maxInputs])}}for(var _i4=0;_i4<outputsData.length;_i4++){var _data=outputsData[_i4].split("\xA7").filter(function(data){return data!==""});connect(customGate.outputGates[_i4],_data)}for(var _i5=0;_i5<gatesData.length;_i5++){var _data2=gatesData[_i5].split("\xA7").filter(function(data){return data!==""});connect(customGate.internGates[_i5],_data2)}customGate.maxOutputs=customGate.outputGates.length;return customGate.setGraphicProperties(mouseX,mouseY,100,30+Math.max(customGate.maxInputs,customGate.maxOutputs)*20,"#379f1f",parts[0])}},{key:"serializeCustomGate",value:function serializeCustomGate(name,inputNames,outputNames){SimulatorState.save(name);var data="";function breakCustomGate(customGate){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=customGate.internGates.concat(customGate.outputGates)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var gate=_step.value;for(var i=0;i<gate.maxInputs;i++){if(gate.inputs[i]===undefined||gate.inputs[i]===null)continue;var inputIndex=customGate.inputGates.indexOf(gate.inputs[i].destination);if(inputIndex!==-1){if(customGate.inputs[inputIndex])gate.inputs[i].destination=customGate.inputs[inputIndex].destination;else gate.inputs.splice(i,1);}}gates.push(gate)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}}function addSeparator(lastToRemove,separator){if(data[data.length-1]===lastToRemove)data=data.substring(0,data.length-1)+separator;else data+=separator}function getIndex(g){var isInput=g instanceof Input;var currentIndex=isInput?0:inputNames.length;for(var i=0;i<gates.length;i++){if(gates[i]===g)return currentIndex;if(isInput){if(gates[i]instanceof Input)currentIndex++}else{if(!(gates[i]instanceof Output)&&!(gates[i]instanceof Input))currentIndex++}}return-1}for(var i=0;i<gates.length;i++){if(gates[i]instanceof CustomGate)breakCustomGate(gates[i])}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=gates[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var gate=_step2.value;for(var _i6=0;_i6<gate.maxInputs;_i6++){if(gate.inputs[_i6])gate.inputs[_i6].destination=gate.inputs[_i6].getInput()}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]!=null){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}gates=gates.filter(function(g){return!(g instanceof ConnectionNode)});gates=gates.filter(function(g){return!(g instanceof CustomGate)}).sort(function(a,b){return a.y-b.y});data=name+";";var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=inputNames[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var inputName=_step3.value;data+=inputName+"&"}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]!=null){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}addSeparator("&",";");var index=0;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=gates[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var _gate=_step4.value;if(_gate instanceof Output){data+=outputNames[index]+"\xA7";var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=_gate.inputs[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var input=_step6.value;data+=(input?getIndex(input.destination):"NULL")+"\xA7"}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally{try{if(!_iteratorNormalCompletion6&&_iterator6["return"]!=null){_iterator6["return"]()}}finally{if(_didIteratorError6){throw _iteratorError6}}}index++;addSeparator("\xA7","&")}}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4["return"]!=null){_iterator4["return"]()}}finally{if(_didIteratorError4){throw _iteratorError4}}}addSeparator("&",";");var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=gates[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var _gate2=_step5.value;if(!(_gate2 instanceof Output)&&!(_gate2 instanceof Input)){data+=_gate2.type+_gate2.serializeParameters()+"\xA7";var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=_gate2.inputs[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var _input=_step7.value;data+=(_input?getIndex(_input.destination):"NULL")+"\xA7"}}catch(err){_didIteratorError7=true;_iteratorError7=err}finally{try{if(!_iteratorNormalCompletion7&&_iterator7["return"]!=null){_iterator7["return"]()}}finally{if(_didIteratorError7){throw _iteratorError7}}}index++;addSeparator("\xA7","&")}}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5["return"]!=null){_iterator5["return"]()}}finally{if(_didIteratorError5){throw _iteratorError5}}}addSeparator("&","");gates=[];return data}}]);return SerializerParser}();"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var SimulatorState=function(){function SimulatorState(){_classCallCheck(this,SimulatorState)}_createClass(SimulatorState,null,[{key:"save",value:function save(saveName){var data={gates:[],interfaceZoomFactor:Interface.zoomFactor};var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=gates[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var gate=_step.value;var gateData=gate.createSave();gateData.inputs=gate.inputs.map(function(input){if(input===undefined||input===null)return null;var dest=input.destination;if(dest instanceof ConnectionNode){var customGate=dest.findParentCustomGate();if(customGate!==null)return[customGate.gate.id,customGate.outputIndex]}return[dest.id]});data.gates.push(gateData)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}Tools.download(JSON.stringify(data),(saveName||"LogicGateSimulator")+".lgs")}},{key:"askForSave",value:function askForSave(){var elem=window.document.createElement("INPUT");elem.accept=".lgs";elem.type="file";elem.click();elem.addEventListener("change",function(){if(elem.files[0])elem.files[0].text().then(SimulatorState.load)})}},{key:"load",value:function load(data){var dataObj=JSON.parse(data);if(dataObj.gates.length===0)return;var gatesIdOffset=Gate.nextID;var newGates=dataObj.gates.map(function(saveObj){var gate;if(saveObj.type==="CUSTOM"){gate=SerializerParser.parseCustomGate(saveObj.string)}else{var gateConstructor=GateFactory[saveObj.type];gate=gateConstructor(0,0)}Object.assign(gate,saveObj);gate.id+=gatesIdOffset;gate.x*=Interface.zoomFactor/dataObj.interfaceZoomFactor;gate.y*=Interface.zoomFactor/dataObj.interfaceZoomFactor;return gate});var averageX=newGates.reduce(function(total,gate){return total+gate.x},0)/newGates.length;var averageY=newGates.reduce(function(total,gate){return total+gate.y},0)/newGates.length;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=newGates[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var gate=_step2.value;gate.x+=canvas.width/2-averageX;gate.y+=canvas.height/2-averageY}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]!=null){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}function findGate(id,outputIndex){var res=newGates.find(function(gate){return gate.id===id});if(outputIndex===undefined)return res;return res.outputGates[outputIndex]}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=newGates[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var _gate=_step3.value;var inputs=_gate.inputs;_gate.inputs=[];for(var i=0;i<inputs.length;i++){if(inputs[i]===null)continue;var destination=findGate(inputs[i][0]+gatesIdOffset,inputs[i][1]);_gate.inputs[i]=new Connection(_gate,destination)}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]!=null){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}Gate.nextID+=newGates.length;gates=gates.concat(newGates)}}]);return SimulatorState}();"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var Clock=function(_Gate){_inherits(Clock,_Gate); function Clock(){var _this;_classCallCheck(this,Clock);_this=_possibleConstructorReturn(this,_getPrototypeOf(Clock).call(this));_this.period=50;_this.current=0;return _this}_createClass(Clock,[{key:"update",value:function update(){this.current--;if(this.current<0){this.current=this.period;this.tempOutput=!this.output}}},{key:"onClick",value:function onClick(){Popup.open();Popup.addTitle("Clock configuration");Popup.addSpace();Popup.addFields([{id:"clockPeriod",defaultValue:this.period}],"Period (milliseconds):");Popup.addFields([{id:"clockCurrent",defaultValue:this.current}],"Current (milliseconds):");Popup.addDoneButton(Clock.chooseParameters);Clock.openedPopup=this}},{key:"setPeriod",value:function setPeriod(period,current){this.period=period;if(current)this.current=current;return this}},{key:"serializeParameters",value:function serializeParameters(){return"@".concat(this.period,"@").concat(this.current)}},{key:"parseParameters",value:function parseParameters(parameters){this.period=parameters[1];this.current=parameters[2]}},{key:"createSave",value:function createSave(){var gateSave=_get(_getPrototypeOf(Clock.prototype),"createSave",this).call(this);gateSave.period=this.period;gateSave.current=this.current;return gateSave}}],[{key:"chooseParameters",value:function chooseParameters(){var period=document.getElementById("clockPeriod").value;if(!isNaN(period))Clock.openedPopup.period=period;var current=document.getElementById("clockCurrent").value;if(!isNaN(current))Clock.openedPopup.current=current;Popup.close()}}]);return Clock}(Gate);_defineProperty(Clock,"openedPopup",void 0);"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var ConnectionNode=function(_Gate){_inherits(ConnectionNode,_Gate);function ConnectionNode(){var _this;_classCallCheck(this,ConnectionNode);_this=_possibleConstructorReturn(this,_getPrototypeOf(ConnectionNode).call(this));_this.upColor="#ea120c";_this.downColor="#7a7a7a";return _this}_createClass(ConnectionNode,[{key:"tickEnd",value:function tickEnd(){_get(_getPrototypeOf(ConnectionNode.prototype),"tickEnd",this).call(this);this.color=this.output?this.upColor:this.downColor}},{key:"findParentCustomGate",value:function findParentCustomGate(){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=gates[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var gate=_step.value;if(!(gate instanceof CustomGate))continue;for(var i=0;i<gate.outputGates.length;i++){if(gate.outputGates[i]==this)return{gate:gate,outputIndex:i}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}return null}}]);return ConnectionNode}(Gate);"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var CustomGate=function(_Gate){_inherits(CustomGate,_Gate);function CustomGate(){var _this;_classCallCheck(this,CustomGate);_this=_possibleConstructorReturn(this,_getPrototypeOf(CustomGate).call(this));_this.internGates=[];_this.inputGates=[];_this.outputGates=[];_this.string="";return _this}_createClass(CustomGate,[{key:"update",value:function update(){for(var i=0;i<this.inputGates.length;i++){this.inputGates[i].output=this.inputs[i]&&this.inputs[i].getValue()}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.internGates[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var gate=_step.value;gate.update()}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"tickEnd",value:function tickEnd(){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.internGates[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var gate=_step2.value;gate.tickEnd()}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]!=null){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"getGateForOutput",value:function getGateForOutput(index){return this.outputGates[index]}},{key:"onClick",value:function onClick(){Popup.open();Popup.addTitle("Custom Gate Information");Popup.addSpace();Popup.addText(this.string);Popup.addDoneButton(Popup.close)}},{key:"createSave",value:function createSave(){var gateSave=_get(_getPrototypeOf(CustomGate.prototype),"createSave",this).call(this);gateSave.string=this.string;gateSave.maxInputs=this.maxInputs;return gateSave}},{key:"draw",value:function draw(){for(var i=0;i<this.outputGates.length;i++){var position=this.getOutputPosition(i);this.outputGates[i].x=position[0];this.outputGates[i].y=position[1]}_get(_getPrototypeOf(CustomGate.prototype),"draw",this).call(this);ctx.fillStyle="#ffffff";ctx.textAlign="center";ctx.textBaseline="middle";ctx.font=this.fontSize*0.8+"px Arial";for(var _i=0;_i<this.outputGates.length;_i++){var _position=this.getOutputPosition(_i);ctx.fillText(this.outputGates[_i].name,_position[0]-this.width/10,_position[1])}for(var _i2=0;_i2<this.inputGates.length;_i2++){var _position2=this.getInputPosition(_i2);ctx.fillText(this.inputGates[_i2].name,_position2[0]-this.width/10,_position2[1])}}},{key:"getOutputPosition",value:function getOutputPosition(index){return[this.x+this.width/2-Interface.connectionWidth,this.y-this.height/2+this.height*(index+1)/(this.maxOutputs+1)]}}],[{key:"openPopup",value:function openPopup(){Popup.open();var nbInputs=0;var nbOutputs=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=gates[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var gate=_step3.value;if(gate instanceof Input)nbInputs++;if(gate instanceof Output)nbOutputs++}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]!=null){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}Popup.addTitle("Custom Gate Configuration");Popup.addSpace();Popup.addFields([{id:"name"}],"Gate name");Popup.addSpace();var inputs=[];for(var i=0;i<nbInputs;i++){inputs.push({id:"input"+i})}if(inputs.length>0)Popup.addFields(inputs,"Input names");Popup.addSpace();var outputs=[];for(var _i3=0;_i3<nbOutputs;_i3++){outputs.push({id:"output"+_i3})}if(inputs.length>0)Popup.addFields(outputs,"Output names");Popup.addSpace();Popup.addDoneButton(function(){var inputs=[];for(var _i4=0;_i4<nbInputs;_i4++){inputs[_i4]=document.getElementById("input"+_i4).value}var outputs=[];for(var _i5=0;_i5<nbOutputs;_i5++){outputs[_i5]=document.getElementById("output"+_i5).value}var gate=SerializerParser.parseCustomGate(SerializerParser.serializeCustomGate(document.getElementById("name").value,inputs,outputs));BuildMode.addGate(gate,false);Popup.close();gate.onClick();BuildMode.lastCustomGate=gate.string})}}]);return CustomGate}(Gate);"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var Input=function(_Gate){_inherits(Input,_Gate);function Input(){var _this;_classCallCheck(this,Input);_this=_possibleConstructorReturn(this,_getPrototypeOf(Input).call(this));_this.upColor="#ea120c";_this.downColor="#7a7a7a";_this.isOn=true;return _this}_createClass(Input,[{key:"update",value:function update(){this.tempOutput=this.isOn}},{key:"onClick",value:function onClick(){this.isOn=!this.isOn}},{key:"createSave",value:function createSave(){var gateSave=_get(_getPrototypeOf(Input.prototype),"createSave",this).call(this);gateSave.isOn=this.isOn;return gateSave}},{key:"drawBody",value:function drawBody(){_get(_getPrototypeOf(Input.prototype),"drawBody",this).call(this);ctx.fillStyle=this.isOn?this.upColor:this.downColor;ctx.fillRect(this.x-this.width/2+this.width/8,this.y-this.height/2+this.height/8,this.width-2*this.width/8,this.height-2*this.height/8)}}]);return Input}(Gate);"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var Output=function(_Gate){_inherits(Output,_Gate);function Output(){var _this;_classCallCheck(this,Output);_this=_possibleConstructorReturn(this,_getPrototypeOf(Output).call(this));_this.upColor="#ea120c";_this.downColor="#7a7a7a";_this.maxOutputs=0;return _this}_createClass(Output,[{key:"tickEnd",value:function tickEnd(){_get(_getPrototypeOf(Output.prototype),"tickEnd",this).call(this);this.color=this.output?this.upColor:this.downColor}}]);return Output}(Gate);"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var Switch=function(_Gate){_inherits(Switch,_Gate);function Switch(){var _this;_classCallCheck(this,Switch);_this=_possibleConstructorReturn(this,_getPrototypeOf(Switch).call(this));_this.isOn=true;return _this}_createClass(Switch,[{key:"update",value:function update(){if(!this.isOn){this.tempOutput=false;return}_get(_getPrototypeOf(Switch.prototype),"update",this).call(this)}},{key:"onClick",value:function onClick(){this.isOn=!this.isOn}},{key:"serializeParameters",value:function serializeParameters(){return"@"+(this.isOn?"1":"0")}},{key:"parseParameters",value:function parseParameters(parameters){this.isOn=parameters[1]==="1";}},{key:"createSave",value:function createSave(){var gateSave=_get(_getPrototypeOf(Switch.prototype),"createSave",this).call(this);gateSave.isOn=this.isOn;return gateSave}},{key:"drawBody",value:function drawBody(){_get(_getPrototypeOf(Switch.prototype),"drawBody",this).call(this);if(!this.isOn){ctx.fillStyle=Interface.BACKGROUND_COLOR;ctx.fillRect(this.x-this.width/2+this.width/5,this.y-this.height/2,this.width-2*this.width/5,this.height)}}}]);return Switch}(Gate);"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var Button=function(){function Button(){_classCallCheck(this,Button);this.x=0;this.y=0;this.width=80;this.height=50;this.name="";this.color="#000000";this.fontSize=14}_createClass(Button,[{key:"setOnClick",value:function setOnClick(onClick){this.onClick=onClick;return this}},{key:"onClick",value:function onClick(){}},{key:"setGraphicProperties",value:function setGraphicProperties(width,height,name,color){this.width=width;this.height=height;this.name=name;this.color=color;return this}},{key:"draw",value:function draw(){ctx.fillStyle=this.color;ctx.fillRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height);ctx.fillStyle=Interface.BACKGROUND_COLOR;ctx.fillRect(this.x-this.width/2+this.width/15,this.y-this.height/2+this.height/15,this.width-2*this.width/15,this.height-2*this.height/15);this.drawCenter()}},{key:"drawCenter",value:function drawCenter(){this.drawName()}},{key:"drawName",value:function drawName(){ctx.fillStyle="#ffffff";ctx.textAlign="center";ctx.textBaseline="middle";ctx.font=this.fontSize+"px Arial";ctx.fillText(this.name,this.x,this.y)}}]);return Button}();"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var Interface=function(){function Interface(){_classCallCheck(this,Interface)}_createClass(Interface,null,[{key:"clear",value:function clear(){ctx.fillStyle=Interface.BACKGROUND_COLOR;ctx.fillRect(0,0,canvas.width,canvas.height)}},{key:"draw",value:function draw(){Interface.getCurrentMode().lateUpdate();Interface.buttons[0].x=canvas.width/2-Interface.buttons[0].width-Interface.BUTTON_SPACING;Interface.buttons[0].y=Interface.buttons[0].height/2+Interface.BUTTON_SPACING;Interface.buttons[1].x=canvas.width/2;Interface.buttons[1].y=Interface.buttons[0].height/2+Interface.BUTTON_SPACING;Interface.buttons[2].x=canvas.width/2+Interface.buttons[0].width+Interface.BUTTON_SPACING;Interface.buttons[2].y=Interface.buttons[0].height/2+Interface.BUTTON_SPACING;Interface.buttons[0].draw();Interface.buttons[1].draw();Interface.buttons[2].draw();Interface.buttons[3].x=0.5*Interface.buttons[3].width+Interface.BUTTON_SPACING;Interface.buttons[3].y=0.5*Interface.buttons[3].height+Interface.BUTTON_SPACING;Interface.buttons[4].x=1.5*Interface.buttons[3].width+2*Interface.BUTTON_SPACING;Interface.buttons[4].y=0.5*Interface.buttons[3].height+Interface.BUTTON_SPACING;Interface.buttons[3].draw();Interface.buttons[4].draw();Interface.buttons[5].x=0.5*Interface.buttons[5].width+Interface.BUTTON_SPACING;Interface.buttons[5].y=0.5*Interface.buttons[5].height+Interface.buttons[3].height+2*Interface.BUTTON_SPACING;Interface.buttons[5].draw();if(framesToCalculate===0){Interface.buttons[6].x=1.5*Interface.buttons[6].width+2*Interface.BUTTON_SPACING;Interface.buttons[6].y=0.5*Interface.buttons[6].height+Interface.buttons[4].height+2*Interface.BUTTON_SPACING;Interface.buttons[6].draw()}else{Interface.buttons[6].x=-1000;Interface.buttons[6].y=-1000}}},{key:"getButtonAtPosition",value:function getButtonAtPosition(x,y){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Interface.getCurrentMode().buttons.concat(Interface.buttons)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var button=_step.value;if(Math.abs(x-button.x)<button.width/2&&Math.abs(y-button.y)<button.height/2)return button}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}return null}},{key:"init",value:function init(){BuildMode.init();WiringMode.init();InteractionMode.init();Interface.buttons=[new Button().setGraphicProperties(90,30,"Build","#ffffff").setOnClick(function(){return BuildMode.enable()}),new Button().setGraphicProperties(90,30,"Wiring","#ffffff").setOnClick(function(){return WiringMode.enable()}),new Button().setGraphicProperties(90,30,"Interaction","#ffffff").setOnClick(function(){return InteractionMode.enable()}),new Button().setGraphicProperties(50,40,"Save","#00e1ff").setOnClick(function(){return SimulatorState.save()()}),new Button().setGraphicProperties(50,40,"Load","#00e1ff").setOnClick(function(){return SimulatorState.askForSave()}),new Button().setGraphicProperties(30,30,"","#ff9100").setOnClick(function(){return framesToCalculate=-!framesToCalculate}),new Button().setGraphicProperties(30,30,"","#ff9100").setOnClick(function(){if(framesToCalculate>=0)framesToCalculate++})];Interface.buttons[5].drawCenter=function(){ctx.beginPath();if(framesToCalculate===0){ctx.moveTo(this.x-this.width/4,this.y-this.height/4);ctx.lineTo(this.x-this.width/4,this.y+this.height/4);ctx.lineTo(this.x+this.width/4,this.y)}else{ctx.moveTo(this.x-this.width/10+this.width/6,this.y+this.height/4);ctx.lineTo(this.x-this.width/10+this.width/6,this.y-this.height/4);ctx.lineTo(this.x+this.width/10+this.width/6,this.y-this.height/4);ctx.lineTo(this.x+this.width/10+this.width/6,this.y+this.height/4);ctx.moveTo(this.x-this.width/10-this.width/6,this.y+this.height/4);ctx.lineTo(this.x-this.width/10-this.width/6,this.y-this.height/4);ctx.lineTo(this.x+this.width/10-this.width/6,this.y-this.height/4);ctx.lineTo(this.x+this.width/10-this.width/6,this.y+this.height/4)}ctx.fillStyle="#ff9100";ctx.fill()};Interface.buttons[6].drawCenter=function(){ctx.beginPath();ctx.moveTo(this.x-this.width/20-this.width/6,this.y+this.height/4);ctx.lineTo(this.x-this.width/20-this.width/6,this.y-this.height/4);ctx.lineTo(this.x+this.width/20-this.width/6,this.y-this.height/4);ctx.lineTo(this.x+this.width/20-this.width/6,this.y+this.height/4);ctx.moveTo(this.x,this.y-this.height/4);ctx.lineTo(this.x,this.y+this.height/4);ctx.lineTo(this.x+this.width/4,this.y);ctx.fillStyle="#ff9100";ctx.fill()}}},{key:"update",value:function update(){Interface.getCurrentMode().earlyUpdate()}},{key:"getCurrentMode",value:function getCurrentMode(){switch(Interface.mode){case 0:return BuildMode;case 1:return WiringMode;case 2:return InteractionMode;}}},{key:"zoom",value:function zoom(factor){Interface.zoomFactor*=factor;Interface.negCircleR*=factor;Interface.connectionWidth*=factor;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=gates[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var gate=_step2.value;gate.width*=factor;gate.height*=factor;gate.x=(gate.x-mouseX)*factor+mouseX;gate.y=(gate.y-mouseY)*factor+mouseY;gate.fontSize*=factor}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]!=null){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}}]);return Interface}();_defineProperty(Interface,"BACKGROUND_COLOR","#353535");_defineProperty(Interface,"BUTTON_SPACING",5);_defineProperty(Interface,"zoomFactor",1);_defineProperty(Interface,"mode",0);_defineProperty(Interface,"blockInputs",false);_defineProperty(Interface,"buttons",[]);_defineProperty(Interface,"negCircleR",5);_defineProperty(Interface,"connectionWidth",3);"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var BuildMode=function(){function BuildMode(){_classCallCheck(this,BuildMode)}_createClass(BuildMode,null,[{key:"init",value:function init(){BuildMode.buttons=[new Button().setGraphicProperties(80,50,"Destroy","#ae110b").setOnClick(function(){return BuildMode.removeGate(BuildMode.selectedGate)}),new Button().setGraphicProperties(80,30,"UP","#379f1f").setOnClick(function(){return BuildMode.selectorPosition=Math.max(0,BuildMode.selectorPosition-1)}),new Button().setGraphicProperties(80,30,"DOWN","#379f1f").setOnClick(function(){return BuildMode.selectorPosition=Math.min(BuildMode.buttons.length-BuildMode.listLength-5,BuildMode.selectorPosition+1)}),new Button().setGraphicProperties(150,60,"Create Custom Gate","#379f1f").setOnClick(function(){return CustomGate.openPopup()}),new Button().setGraphicProperties(150,60,"Last Custom Gate","#379f1f").setOnClick(function(){return BuildMode.addGate(SerializerParser.parseCustomGate(BuildMode.lastCustomGate))}),new Button().setGraphicProperties(80,80,"AND","#379f1f").setOnClick(function(){return BuildMode.addGate(GateFactory.AND(mouseX,mouseY))}),new Button().setGraphicProperties(80,80,"OR","#379f1f").setOnClick(function(){return BuildMode.addGate(GateFactory.OR(mouseX,mouseY))}),new Button().setGraphicProperties(80,80,"NOT","#379f1f").setOnClick(function(){return BuildMode.addGate(GateFactory.NOT(mouseX,mouseY))}),new Button().setGraphicProperties(80,80,"XOR","#379f1f").setOnClick(function(){return BuildMode.addGate(GateFactory.XOR(mouseX,mouseY))}),new Button().setGraphicProperties(80,80,"NOR","#379f1f").setOnClick(function(){return BuildMode.addGate(GateFactory.NOR(mouseX,mouseY))}),new Button().setGraphicProperties(80,80,"NAND","#379f1f").setOnClick(function(){return BuildMode.addGate(GateFactory.NAND(mouseX,mouseY))}),new Button().setGraphicProperties(80,80,"XNOR","#379f1f").setOnClick(function(){return BuildMode.addGate(GateFactory.XNOR(mouseX,mouseY))}),new Button().setGraphicProperties(80,80,"UP","#379f1f").setOnClick(function(){return BuildMode.addGate(GateFactory.UP(mouseX,mouseY))}),new Button().setGraphicProperties(80,80,"DOWN","#379f1f").setOnClick(function(){return BuildMode.addGate(GateFactory.DOWN(mouseX,mouseY))}),new Button().setGraphicProperties(80,80,"CLOCK","#379f1f").setOnClick(function(){return BuildMode.addGate(GateFactory.CLOCK(mouseX,mouseY,200))}),new Button().setGraphicProperties(80,80,"INPUT","#379f1f").setOnClick(function(){return BuildMode.addGate(GateFactory.INPUT(mouseX,mouseY))}),new Button().setGraphicProperties(80,80,"OUTPUT","#379f1f").setOnClick(function(){return BuildMode.addGate(GateFactory.OUTPUT(mouseX,mouseY))}),new Button().setGraphicProperties(80,80,"SWITCH","#379f1f").setOnClick(function(){return BuildMode.addGate(GateFactory.SWITCH(mouseX,mouseY))}),new Button().setGraphicProperties(80,80,"NODE","#379f1f").setOnClick(function(){return BuildMode.addGate(GateFactory.NODE(mouseX,mouseY))}),new Button().setGraphicProperties(80,80,"CUSTOM","#379f1f").setOnClick(function(){return BuildMode.openCustomGatePopup()})];BuildMode.buttons[1].drawCenter=function(){ctx.beginPath();ctx.moveTo(this.x-this.width/8,this.y+this.height/8);ctx.lineTo(this.x+this.width/8,this.y+this.height/8);ctx.lineTo(this.x,this.y-this.height/8);ctx.moveTo(this.x-this.width/8,this.y-this.height/8);ctx.fillStyle="#379f1f";ctx.fill()};BuildMode.buttons[2].drawCenter=function(){ctx.beginPath();ctx.moveTo(this.x-this.width/8,this.y-this.height/8);ctx.lineTo(this.x+this.width/8,this.y-this.height/8);ctx.lineTo(this.x,this.y+this.height/8);ctx.moveTo(this.x-this.width/8,this.y-this.height/8);ctx.fillStyle="#379f1f";ctx.fill()}}},{key:"enable",value:function enable(){Interface.mode=0;BuildMode.selectedGate=null}},{key:"earlyUpdate",value:function earlyUpdate(){if(BuildMode.selectedGate){BuildMode.selectedGate.x=mouseX;BuildMode.selectedGate.y=mouseY}}},{key:"lateUpdate",value:function lateUpdate(){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=BuildMode.buttons[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var button=_step.value;button.x=-100;button.y=-100}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}BuildMode.buttons[0].x=canvas.width-BuildMode.buttons[0].width/2-Interface.BUTTON_SPACING;BuildMode.buttons[0].y=canvas.height-BuildMode.buttons[0].height/2-Interface.BUTTON_SPACING;BuildMode.buttons[0].draw();BuildMode.listLength=Math.floor((canvas.height-BuildMode.buttons[0].height-2*BuildMode.buttons[1].height-5*Interface.BUTTON_SPACING)/(BuildMode.buttons[5].height+Interface.BUTTON_SPACING));BuildMode.buttons[1].x=canvas.width-BuildMode.buttons[1].width/2-Interface.BUTTON_SPACING;BuildMode.buttons[1].y=BuildMode.buttons[1].height/2+Interface.BUTTON_SPACING;BuildMode.buttons[2].x=canvas.width-BuildMode.buttons[2].width/2-Interface.BUTTON_SPACING;BuildMode.buttons[2].y=BuildMode.buttons[5].height*BuildMode.listLength+1.5*BuildMode.buttons[1].height+Interface.BUTTON_SPACING*(2+BuildMode.listLength);BuildMode.buttons[1].draw();BuildMode.buttons[2].draw();if(5+BuildMode.selectorPosition+BuildMode.listLength-1>=BuildMode.buttons.length)BuildMode.selectorPosition=BuildMode.buttons.length-BuildMode.listLength-5;for(var i=0;i<BuildMode.listLength;i++){if(BuildMode.selectorPosition+i+5>BuildMode.buttons.length)break;BuildMode.buttons[BuildMode.selectorPosition+i+5].x=canvas.width-BuildMode.buttons[5].width/2-Interface.BUTTON_SPACING;BuildMode.buttons[BuildMode.selectorPosition+i+5].y=BuildMode.buttons[1].height+(i+0.5)*BuildMode.buttons[5].height+(i+2)*Interface.BUTTON_SPACING;BuildMode.buttons[BuildMode.selectorPosition+i+5].draw()}BuildMode.buttons[3].x=BuildMode.buttons[3].width/2+Interface.BUTTON_SPACING;BuildMode.buttons[3].y=canvas.height-BuildMode.buttons[3].height/2-Interface.BUTTON_SPACING;if(BuildMode.lastCustomGate!==""){BuildMode.buttons[4].x=BuildMode.buttons[3].width+BuildMode.buttons[4].width/2+2*Interface.BUTTON_SPACING;BuildMode.buttons[4].y=canvas.height-BuildMode.buttons[4].height/2-Interface.BUTTON_SPACING;BuildMode.buttons[4].draw()}else{BuildMode.buttons[4].x=-100;BuildMode.buttons[4].y=-100}BuildMode.buttons[3].draw()}},{key:"onClick",value:function onClick(){if(BuildMode.selectedGate!==null)BuildMode.selectedGate=null;else BuildMode.selectedGate=Tools.getGateAtPosition(mouseX,mouseY)}},{key:"onKeyPressed",value:function onKeyPressed(key){if(key==="Delete")BuildMode.removeGate(BuildMode.selectedGate);if(key==="a")BuildMode.addGate(GateFactory.AND(mouseX,mouseY),false);if(key==="o")BuildMode.addGate(GateFactory.OR(mouseX,mouseY),false);if(key==="n")BuildMode.addGate(GateFactory.NOT(mouseX,mouseY),false);if(key==="x")BuildMode.addGate(GateFactory.XOR(mouseX,mouseY),false);if(key===" "){if(BuildMode.lastGate==="CUSTOM")BuildMode.addGate(SerializerParser.parseCustomGate(BuildMode.lastCustomGate),false);else if(BuildMode.lastGate!==""){var gateConstructor=GateFactory[BuildMode.lastGate];BuildMode.addGate(gateConstructor(mouseX,mouseY),false)}}}},{key:"openCustomGatePopup",value:function openCustomGatePopup(){Popup.open();Popup.addTitle("Custom Gate");Popup.addText("Data for your gate (you can generate it with the Build Custom Gate button)");Popup.addFields([{id:"rawData"}]," ");Popup.addDoneButton(function(){var gate=SerializerParser.parseCustomGate(document.getElementById("rawData").value);BuildMode.addGate(gate);BuildMode.lastCustomGate=gate.string;Popup.close()})}},{key:"addGate",value:function addGate(gate,select){if(select===undefined||select)BuildMode.selectedGate=gate;gate.id=Gate.nextID;Gate.nextID++;BuildMode.lastGate=gate.type;gates.push(gate)}},{key:"removeGate",value:function removeGate(gate){gates=gates.remove(gate);BuildMode.selectedGate=null;if(gate instanceof CustomGate){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=gate.outputGates[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var outputGate=_step2.value;Gate.removeAllConnectionsTo(outputGate,gates)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]!=null){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}else Gate.removeAllConnectionsTo(gate,gates)}}]);return BuildMode}();_defineProperty(BuildMode,"selectedGate",null);_defineProperty(BuildMode,"selectorPosition",0);_defineProperty(BuildMode,"listLength",0);_defineProperty(BuildMode,"lastCustomGate","");_defineProperty(BuildMode,"lastGate","");_defineProperty(BuildMode,"buttons",void 0);"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var InteractionMode=function(){function InteractionMode(){_classCallCheck(this,InteractionMode)}_createClass(InteractionMode,null,[{key:"init",value:function init(){InteractionMode.buttons=[]}},{key:"enable",value:function enable(){Interface.mode=2}},{key:"earlyUpdate",value:function earlyUpdate(){}},{key:"lateUpdate",value:function lateUpdate(){}},{key:"onClick",value:function onClick(){var selectedGate=Tools.getGateAtPosition(mouseX,mouseY);if(selectedGate)selectedGate.onClick()}},{key:"onKeyPressed",value:function onKeyPressed(key){}}]);return InteractionMode}();_defineProperty(InteractionMode,"buttons",void 0);"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var WiringMode=function(){function WiringMode(){_classCallCheck(this,WiringMode)}_createClass(WiringMode,null,[{key:"init",value:function init(){WiringMode.buttons=[]}},{key:"enable",value:function enable(){Interface.mode=1;WiringMode.selectedOutput=undefined;WiringMode.selectedInput=undefined}},{key:"earlyUpdate",value:function earlyUpdate(){if(WiringMode.selectedOutput||WiringMode.selectedInput){var alreadySelected=WiringMode.selectedInput?WiringMode.selectedInput.getInputPosition(WiringMode.inputIndex):[WiringMode.selectedOutput.x+WiringMode.selectedOutput.width/2-Interface.connectionWidth,WiringMode.selectedOutput.y];var suggestion=WiringMode.findClosestConnectionSlot(WiringMode.selectedOutput!==undefined);var secondSlotSuggestion=suggestion!==undefined?[suggestion.x,suggestion.y]:[mouseX,mouseY];ctx.beginPath();ctx.strokeStyle="#d3d3d3";ctx.lineWidth=Interface.connectionWidth;ctx.moveTo(alreadySelected[0],alreadySelected[1]);ctx.lineTo(secondSlotSuggestion[0],secondSlotSuggestion[1]);ctx.stroke()}}},{key:"lateUpdate",value:function lateUpdate(){if(WiringMode.selectedOutput||WiringMode.selectedInput){var suggestion=WiringMode.findClosestConnectionSlot(WiringMode.selectedOutput!==undefined);if(suggestion)Tools.fillCircle(suggestion.x,suggestion.y,10*Interface.zoomFactor,"rgba(255, 255, 255, 0.5)",false)}else{var _suggestion=WiringMode.findClosestConnectionSlot();if(_suggestion)Tools.fillCircle(_suggestion.x,_suggestion.y,10*Interface.zoomFactor,"rgba(255, 255, 255, 0.5)",false)}}},{key:"onClick",value:function onClick(){WiringMode.handleClick()}},{key:"onKeyPressed",value:function onKeyPressed(key){}},{key:"findClosestConnectionSlot",value:function findClosestConnectionSlot(searchInput){var closest=undefined;var closestDistanceSqr=Infinity;function updateClosest(connector){var distanceSqr=Tools.sqr(mouseX-connector.x)+Tools.sqr(mouseY-connector.y);if(distanceSqr<Tools.sqr(WiringMode.AUTO_SNAP_RANGE*Interface.zoomFactor)&&distanceSqr<closestDistanceSqr){closestDistanceSqr=distanceSqr;closest=connector}}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=gates[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var gate=_step.value;if(searchInput===undefined||searchInput){for(var i=0;i<gate.maxInputs;i++){var position=gate.getInputPosition(i);var connector={x:position[0],y:position[1],gate:gate,index:i,isInput:true};updateClosest(connector)}}if(searchInput===undefined||!searchInput){for(var _i=0;_i<gate.maxOutputs;_i++){var _position=gate.getOutputPosition(_i);var _connector={x:_position[0],y:_position[1],gate:gate,index:_i,isInput:false};updateClosest(_connector)}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}return closest}},{key:"handleClick",value:function handleClick(){var lookingForInputs=undefined;if(WiringMode.selectedInput)lookingForInputs=false;if(WiringMode.selectedOutput)lookingForInputs=true;var slot=WiringMode.findClosestConnectionSlot(lookingForInputs);if(!slot){WiringMode.selectedOutput=undefined;WiringMode.selectedInput=undefined;return}if(!WiringMode.selectedInput&&!WiringMode.selectedOutput&&slot.isInput&&slot.gate.inputs[slot.index]){WiringMode.selectedOutput=slot.gate.inputs[slot.index].destination;slot.gate.inputs[slot.index]=undefined;return}if(!WiringMode.selectedOutput&&!slot.isInput)WiringMode.selectedOutput=slot.gate.getGateForOutput(slot.index);if(!WiringMode.selectedInput&&slot.isInput){WiringMode.selectedInput=slot.gate;WiringMode.inputIndex=slot.index}if(WiringMode.selectedInput&&WiringMode.selectedOutput){WiringMode.selectedInput.addInput(WiringMode.selectedOutput,WiringMode.inputIndex);WiringMode.selectedOutput=undefined;WiringMode.selectedInput=undefined}}}]);return WiringMode}();_defineProperty(WiringMode,"AUTO_SNAP_RANGE",40);_defineProperty(WiringMode,"selectedOutput",void 0);_defineProperty(WiringMode,"selectedInput",void 0);_defineProperty(WiringMode,"inputIndex",void 0);_defineProperty(WiringMode,"buttons",void 0);"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var Popup=function(){function Popup(){_classCallCheck(this,Popup)}_createClass(Popup,null,[{key:"open",value:function open(){Popup.containerDiv=document.createElement("DIV");Popup.mainDiv.appendChild(Popup.containerDiv);popupBackground.style.display="block";Interface.blockInputs=true}},{key:"close",value:function close(){Popup.containerDiv=undefined;var child=Popup.mainDiv.lastElementChild;while(child){Popup.mainDiv.removeChild(child);child=Popup.mainDiv.lastElementChild}popupBackground.style.display="none";Interface.blockInputs=false}},{key:"closeIfClickedOnBackground",value:function closeIfClickedOnBackground(){if(mouseX>canvas.width*0.1&&mouseX<canvas.width*0.9&&mouseY>canvas.height*0.1&&mouseY<canvas.height*0.9)return;Popup.close()}},{key:"addFields",value:function addFields(fields,title){var fieldsContainer=Popup.containerDiv;if(title){var text=document.createElement("P");text.innerHTML=title+" ";text.classList.add("popupElementTitle");Popup.containerDiv.appendChild(text);fieldsContainer=text}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=fields[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var field=_step.value;var input=document.createElement("INPUT");if(field.id)input.id=field.id;input.value=field.defaultValue||"";input.classList.add("popupInput");fieldsContainer.appendChild(input)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"addButtons",value:function addButtons(buttons,title){var buttonsContainer=Popup.containerDiv;if(title){var text=document.createElement("P");text.innerHTML=title;text.classList.add("popupElementTitle");Popup.containerDiv.appendChild(text);buttonsContainer=text}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=buttons[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var button=_step2.value;var b=document.createElement("BUTTON");b.innerHTML=button.title;b.addEventListener("click",button.clickEvent);b.classList.add("popupButton");buttonsContainer.appendChild(b)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]!=null){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"addDoneButton",value:function addDoneButton(clickEvent){var b=document.createElement("BUTTON");b.innerHTML="Done";b.addEventListener("click",clickEvent);b.classList.add("popupDoneButton");Popup.containerDiv.appendChild(b)}},{key:"addTitle",value:function addTitle(text){var separator=document.createElement("HR");separator.innerHTML=text;separator.classList.add("popupTitle");Popup.containerDiv.appendChild(separator)}},{key:"addSpace",value:function addSpace(size){if(size===undefined)size=1;for(var i=0;i<size;i++){Popup.addText("<br>")}}},{key:"addText",value:function addText(text){var t=document.createElement("P");t.innerHTML=text;t.classList.add("popupText");Popup.containerDiv.appendChild(t)}}]);return Popup}();_defineProperty(Popup,"mainDiv",document.getElementById("popup_main_div"));_defineProperty(Popup,"containerDiv",void 0);"use strict";var mouseX=0;var mouseY=0;document.addEventListener("mousemove",function(event){mouseX=event.clientX-canvas.offsetLeft;mouseY=event.clientY-canvas.offsetTop});document.addEventListener("click",function(){if(Interface.blockInputs)return;var clickedButton=Interface.getButtonAtPosition(mouseX,mouseY);if(clickedButton){clickedButton.onClick();return}Interface.getCurrentMode().onClick()});document.onkeydown=function(event){switch(event.key){case"Escape":Popup.close();}if(Interface.blockInputs)return;switch(event.key){case"b":BuildMode.enable();break;case"w":WiringMode.enable();break;case"i":InteractionMode.enable();break;}Interface.getCurrentMode().onKeyPressed(event.key)};canvas.addEventListener("wheel",function(event){if(Interface.blockInputs)return;Interface.zoom(1-event.deltaY/1000)});
</script>

</body>
</html>
