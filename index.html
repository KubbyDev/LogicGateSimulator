<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Logic Gate Simulator</title>
    <link rel="stylesheet" type="text/css" href="Simulator/Style.css"/>
</head>
<body>

<canvas id="canvas" width="1400" height="700"></canvas>

<div id="popup_bg" onclick="Popup.closeIfClickedOnBackground()">
    <div id="popup_main_div">
        <!-- Filled by the program when needed -->
    </div>
</div>

<!-- This HTML went through Babel and javascript-minifier, so its not readable -->
<!-- for a human being. The readable version of the code can be found here: -->
<!-- https://github.com/KubbyDev/LogicGateSimulator/tree/master/Simulator -->
<script>
"use strict";var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),popupBackground=document.getElementById("popup_bg"),gates=[],framesToCalculate=-1;function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}setTimeout(function(){Interface.init(),setInterval(function(){Interface.clear(),Interface.update(),0!==framesToCalculate&&Gate.updateAll(gates),framesToCalculate>0&&framesToCalculate--,Gate.drawAll(gates),Interface.draw()},1)},100);var Tools=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"fillCircle",value:function(t,e,n,i,r,o){ctx.beginPath(),ctx.fillStyle=i||"#ffffff",ctx.arc(t,e,n,0,2*Math.PI),ctx.fill(),(void 0===r||r)&&(ctx.lineWidth=1,ctx.strokeStyle=o||"#000000",ctx.stroke())}},{key:"resizeCanvas",value:function(){canvas.width=window.innerWidth+1,setTimeout(function(){canvas.height=window.innerHeight+1},0)}},{key:"download",value:function(t,e){var n=new Blob([t],{type:"text/plain"}),i=window.document.createElement("a");i.href=window.URL.createObjectURL(n),i.download=e||"LogicGateSimulator",i.click()}},{key:"sqr",value:function(t){return t*t}},{key:"getGateAtPosition",value:function(t,e){var n=!0,i=!1,r=void 0;try{for(var o,a=gates[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(Math.abs(t-s.x)<s.width/2&&Math.abs(e-s.y)<s.height/2)return s}}catch(t){i=!0,r=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}return null}}]),t}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}Array.prototype.remove=function(t){return this.filter(function(e){return e!==t})},Array.prototype.removeAll=function(t){return this.filter(function(e){return!t.includes(e)})},window.onresize=Tools.resizeCanvas,Tools.resizeCanvas();var Connection=function(){function t(e,n){_classCallCheck(this,t),this.destination=n,this.origin=e}return _createClass(t,[{key:"getInput",value:function(t){if(this.destination instanceof ConnectionNode){if(void 0===t&&(t=[]),t.includes(this.destination.id))return;return t.push(this.destination.id),this.destination.inputs[0]?this.destination.inputs[0].getInput(t):void 0}return this.destination}},{key:"getValue",value:function(){return void 0!==this.getInput()&&void 0!==this.getInput().output&&this.getInput().output}},{key:"draw",value:function(e){var n=this.origin.getInputPosition(e),i=this.destination.getOutputPosition();ctx.beginPath(),ctx.moveTo(n[0]+this.origin.width/4,n[1]);var r=!0,o=!1,a=void 0;try{for(var s,u=this.calculateIntermediates(i[0],i[1],n[0],n[1])[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var c=s.value;ctx.lineTo(c[0],c[1])}}catch(t){o=!0,a=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}ctx.lineTo(i[0],i[1]),ctx.lineWidth=Interface.connectionWidth,ctx.strokeStyle=this.getValue()?t.upColor:t.downColor,ctx.stroke()}},{key:"calculateIntermediates",value:function(t,e,n,i){var r=(n+t)/2,o=(i+e)/2;return n-Interface.connectionGap<t+Interface.connectionGap?[[n-Interface.connectionGap,i],[n-Interface.connectionGap,o],[t+Interface.connectionGap,o],[t+Interface.connectionGap,e]]:[[r,i],[r,e]]}}]),t}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}_defineProperty(Connection,"downColor","#d3d3d3"),_defineProperty(Connection,"upColor","#ffbf00");var Gate=function(){function t(){_classCallCheck(this,t),this.activation=function(){return!0},this.inputs=[],this.prevOutput=!1,this.output=!1,this.maxInputs=0,this.maxOutputs=1,this.id=-1,this.x=10,this.y=10,this.width=20,this.height=20,this.color="#379f1f",this.type="",this.name="",this.fontSize=8,this.hideName=!1}return _createClass(t,[{key:"setFonctionnalProperties",value:function(t,e,n,i){return e&&(this.activation=e),this.maxInputs=void 0!==i?i:0,this.setInputs(void 0!==n?n:[]),this.type=t,this}},{key:"setInputs",value:function(t){var e=this;return this.inputs=t.map(function(t){return new Connection(e,t)}).slice(0,this.maxInputs),this}},{key:"setHideName",value:function(t){return this.hideName=t,this}},{key:"addInput",value:function(t,e){void 0!==e&&e<this.maxInputs?this.inputs[e]=new Connection(this,t):this.inputs.length<this.maxInputs&&this.inputs.push(new Connection(this,t))}},{key:"update",value:function(){for(var t=[],e=0;e<this.maxInputs;e++)t[e]=void 0!==this.inputs[e]&&this.inputs[e].getValue();var n=this.activation(t);n===this.prevOutput&&(this.output=n)}},{key:"tickEnd",value:function(){for(var t=[],e=0;e<this.maxInputs;e++)t[e]=void 0!==this.inputs[e]&&this.inputs[e].getValue();this.prevOutput=this.activation(t)}},{key:"getGateForOutput",value:function(t){return this}},{key:"serializeParameters",value:function(){return""}},{key:"parseParameters",value:function(t){}},{key:"onClick",value:function(){}},{key:"createSave",value:function(){return{x:this.x,y:this.y,output:this.output,type:this.type,id:this.id}}},{key:"setGraphicProperties",value:function(t,e,n,i,r,o){return this.x=t,this.y=e,this.width=n*Interface.zoomFactor,this.height=i*Interface.zoomFactor,this.color=r,o&&(this.name=o),this.fontSize*=Interface.zoomFactor,this}},{key:"setPosition",value:function(t,e){return this.x=t,this.y=e,this}},{key:"draw",value:function(){this.drawBody(),this.hideName||(ctx.fillStyle="#ffffff",ctx.textAlign="center",ctx.textBaseline="middle",ctx.font=this.fontSize+"px Arial",ctx.fillText(this.name,this.x,this.y))}},{key:"drawBody",value:function(){ctx.fillStyle=this.color,ctx.fillRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height),ctx.strokeStyle="#000000",ctx.lineWidth=1,ctx.strokeRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height)}},{key:"getInputPosition",value:function(t){return[this.x-this.width/2+Interface.connectionWidth,this.y-this.height/2+this.height*(t+1)/(this.maxInputs+1)]}},{key:"getOutputPosition",value:function(){return[this.x+this.width/2-Interface.connectionWidth,this.y]}}],[{key:"updateAll",value:function(t){var e=!0,n=!1,i=void 0;try{for(var r,o=t[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.update()}}catch(t){n=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw i}}var a=!0,s=!1,u=void 0;try{for(var c,l=t[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){c.value.tickEnd()}}catch(t){s=!0,u=t}finally{try{a||null==l.return||l.return()}finally{if(s)throw u}}}},{key:"removeAllConnectionsTo",value:function(t,e){var n=!0,i=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0)for(var s=o.value,u=0;u<s.inputs.length;u++)void 0!==s.inputs[u]&&s.inputs[u].destination===t&&(s.inputs[u]=void 0)}catch(t){i=!0,r=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}}},{key:"drawAll",value:function(t){var e=!0,n=!1,i=void 0;try{for(var r,o=t[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)for(var a=r.value,s=0;s<a.maxInputs;s++)a.inputs[s]&&a.inputs[s].draw(s)}catch(t){n=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw i}}var u=!0,c=!1,l=void 0;try{for(var h,f=t[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){h.value.draw()}}catch(t){c=!0,l=t}finally{try{u||null==f.return||f.return()}finally{if(c)throw l}}}}]),t}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}_defineProperty(Gate,"nextID",0);var GateFactory=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"UP",value:function(t,e){return(new Gate).setFonctionnalProperties("UP",function(){return!0},[]).setGraphicProperties(t,e,40,40,"#ffbf00")}},{key:"DOWN",value:function(t,e){return(new Gate).setFonctionnalProperties("DOWN",function(){return!1},[]).setGraphicProperties(t,e,40,40,"#5f5f5f")}},{key:"NOT",value:function(t,e,n){var i=(new Gate).setFonctionnalProperties("NOT",function(t){return!t[0]},n,1).setGraphicProperties(t,e,30,20,"#379f1f");return i.drawBody=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/2,this.y-this.height/2),ctx.lineTo(this.x+this.width/2-2*Interface.negCircleR,this.y),ctx.lineTo(this.x-this.width/2,this.y+this.height/2),ctx.lineTo(this.x-this.width/2,this.y-this.height/2),ctx.fillStyle=this.color,ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#000000",ctx.stroke(),Tools.fillCircle(this.x+this.width/2-Interface.negCircleR,this.y,Interface.negCircleR)},i.hideName=!0,i}},{key:"AND",value:function(t,e,n){var i=(new Gate).setFonctionnalProperties("AND",function(t){return t[0]&&t[1]},n,2).setGraphicProperties(t,e,40,40,"#379f1f");return i.drawBody=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/2,this.y-this.height/2),ctx.lineTo(this.x+this.width/2-this.height/2,this.y-this.height/2),ctx.arc(this.x+this.width/2-this.height/2,this.y,this.height/2,-Math.PI/2,Math.PI/2),ctx.lineTo(this.x-this.width/2,this.y+this.height/2),ctx.lineTo(this.x-this.width/2,this.y-this.height/2),ctx.fillStyle=this.color,ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#000000",ctx.stroke()},i.hideName=!0,i}},{key:"OR",value:function(t,e,n){var i=(new Gate).setFonctionnalProperties("OR",function(t){return t[0]||t[1]},n,2).setGraphicProperties(t,e,40,40,"#379f1f");return i.drawBody=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/2,this.y+this.height/2),ctx.quadraticCurveTo(this.x-this.width/4,this.y,this.x-this.width/2,this.y-this.height/2),ctx.quadraticCurveTo(this.x+this.width/4,this.y-this.height/2,this.x+this.width/2,this.y),ctx.moveTo(this.x-this.width/2,this.y+this.height/2),ctx.quadraticCurveTo(this.x+this.width/4,this.y+this.height/2,this.x+this.width/2,this.y),ctx.fillStyle=this.color,ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#000000",ctx.stroke()},i.hideName=!0,i}},{key:"XOR",value:function(t,e,n){var i=(new Gate).setFonctionnalProperties("XOR",function(t){return t[0]!==t[1]},n,2).setGraphicProperties(t,e,45,40,"#379f1f");return i.drawBody=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/2+this.width/8,this.y+this.height/2),ctx.quadraticCurveTo(this.x-this.width/4+this.width/8,this.y,this.x-this.width/2+this.width/8,this.y-this.height/2),ctx.quadraticCurveTo(this.x+this.width/4,this.y-this.height/2,this.x+this.width/2,this.y),ctx.moveTo(this.x-this.width/2+this.width/8,this.y+this.height/2),ctx.quadraticCurveTo(this.x+this.width/4,this.y+this.height/2,this.x+this.width/2,this.y),ctx.fillStyle=this.color,ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#000000",ctx.stroke(),ctx.beginPath(),ctx.moveTo(this.x-this.width/2,this.y+this.height/2),ctx.quadraticCurveTo(this.x-this.width/4,this.y,this.x-this.width/2,this.y-this.height/2),ctx.lineWidth=3,ctx.strokeStyle="#000000",ctx.stroke()},i.hideName=!0,i}},{key:"NAND",value:function(t,e,n){var i=(new Gate).setFonctionnalProperties("NAND",function(t){return!(t[0]&&t[1])},n,2).setGraphicProperties(t,e,50,40,"#379f1f");return i.drawBody=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/2,this.y-this.height/2),ctx.lineTo(this.x+this.width/2-this.height/2-2*Interface.negCircleR,this.y-this.height/2),ctx.arc(this.x+this.width/2-this.height/2-2*Interface.negCircleR,this.y,this.height/2,-Math.PI/2,Math.PI/2),ctx.lineTo(this.x-this.width/2,this.y+this.height/2),ctx.lineTo(this.x-this.width/2,this.y-this.height/2),ctx.fillStyle=this.color,ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#000000",ctx.stroke(),Tools.fillCircle(this.x+this.width/2-Interface.negCircleR,this.y,Interface.negCircleR)},i.hideName=!0,i}},{key:"NOR",value:function(t,e,n){var i=(new Gate).setFonctionnalProperties("NOR",function(t){return!(t[0]||t[1])},n,2).setGraphicProperties(t,e,50,40,"#379f1f");return i.drawBody=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/2,this.y+this.height/2),ctx.quadraticCurveTo(this.x-this.width/4,this.y,this.x-this.width/2,this.y-this.height/2),ctx.quadraticCurveTo(this.x+this.width/4-2*Interface.negCircleR,this.y-this.height/2,this.x+this.width/2-2*Interface.negCircleR,this.y),ctx.moveTo(this.x-this.width/2,this.y+this.height/2),ctx.quadraticCurveTo(this.x+this.width/4-2*Interface.negCircleR,this.y+this.height/2,this.x+this.width/2-2*Interface.negCircleR,this.y),ctx.fillStyle=this.color,ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#000000",ctx.stroke(),Tools.fillCircle(this.x+this.width/2-Interface.negCircleR,this.y,Interface.negCircleR)},i.hideName=!0,i}},{key:"XNOR",value:function(t,e,n){var i=(new Gate).setFonctionnalProperties("XNOR",function(t){return t[0]===t[1]},n,2).setGraphicProperties(t,e,55,40,"#379f1f");return i.drawBody=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/2+this.width/8,this.y+this.height/2),ctx.quadraticCurveTo(this.x-this.width/4+this.width/8,this.y,this.x-this.width/2+this.width/8,this.y-this.height/2),ctx.quadraticCurveTo(this.x+this.width/4-2*Interface.negCircleR,this.y-this.height/2,this.x+this.width/2-2*Interface.negCircleR,this.y),ctx.moveTo(this.x-this.width/2+this.width/8,this.y+this.height/2),ctx.quadraticCurveTo(this.x+this.width/4-2*Interface.negCircleR,this.y+this.height/2,this.x+this.width/2-2*Interface.negCircleR,this.y),ctx.fillStyle=this.color,ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#000000",ctx.stroke(),ctx.beginPath(),ctx.moveTo(this.x-this.width/2,this.y+this.height/2),ctx.quadraticCurveTo(this.x-this.width/4,this.y,this.x-this.width/2,this.y-this.height/2),ctx.lineWidth=3,ctx.strokeStyle="#000000",ctx.stroke(),Tools.fillCircle(this.x+this.width/2-Interface.negCircleR,this.y,Interface.negCircleR)},i.hideName=!0,i}},{key:"INPUT",value:function(t,e){return(new Input).setFonctionnalProperties("INPUT").setGraphicProperties(t,e,40,40,"#db7ed2")}},{key:"CLOCK",value:function(t,e,n){return(new Clock).setPeriod(n).setFonctionnalProperties("CLOCK").setGraphicProperties(t,e,40,40,"#3d79e7")}},{key:"OUTPUT",value:function(t,e,n){return(new Output).setFonctionnalProperties("OUTPUT",function(t){return t[0]},n,1).setGraphicProperties(t,e,40,40,"#7a7a7a").setHideName(!0)}},{key:"NODE",value:function(t,e,n){return(new ConnectionNode).setFonctionnalProperties("NODE",function(t){return t[0]},n,1).setGraphicProperties(t,e,10,7,"#7a7a7a").setHideName(!0)}},{key:"SWITCH",value:function(t,e,n){return(new Switch).setFonctionnalProperties("SWITCH",function(t){return t[0]},n,1).setGraphicProperties(t,e,45,20,"#ffbb25")}}]),t}(),gatesLibrary=[{name:"AND 3",code:"AND3;A&B&C;O$4;AND$0$1&AND$3$2"},{name:"OR 3",code:"OR3;A&B&C;O$4;OR$0$1&OR$3$2"},{name:"NAND 3",code:"NAND3;A&B&C;O$4;AND$0$1&NAND$3$2"},{name:"NOR 3",code:"NOR3;A&B&C;O$4;OR$0$1&NOR$3$2"},{name:"AND 4",code:"AND4;A&B&C&D;O$5;AND$0$1&AND$4$6&AND$2$3"},{name:"OR 4",code:"OR4;A&B&C&D;O$5;OR$0$1&OR$4$6&OR$2$3"},{name:"NAND 4",code:"NAND4;A&B&C&D;O$5;AND$0$1&NAND$4$6&AND$2$3"},{name:"NOR 4",code:"NOR4;A&B&C&D;O$5;OR$0$1&NOR$4$6&OR$2$3"},{name:"1b Memory",code:"1b MEM;DataIN&WriteEN;DataOUT$2;NOR$5$3&NOR$2$6&NOT$0&AND$4$1&AND$0$1"},{name:"1 Byte Memory",code:"1B MEM;I0&I1&I2&I3&I4&I5&I6&I7&WE&CS;O0$50&O1$51&O2$52&O3$53&O4$54&O5$55&O6$56&O7$57;NOR$13$11&NOR$10$14&NOT$0&AND$12$8&AND$0$8&NOR$18$16&NOR$15$19&NOT$2&AND$17$8&AND$2$8&NOR$23$21&NOR$20$24&NOT$3&AND$22$8&AND$3$8&NOR$28$26&NOR$25$29&NOT$4&AND$27$8&AND$4$8&NOR$33$31&NOR$30$34&NOT$5&AND$32$8&AND$5$8&NOR$38$36&NOR$35$39&NOT$6&AND$37$8&AND$6$8&NOR$43$41&NOR$40$44&NOT$1&AND$42$8&AND$1$8&NOR$48$46&NOR$45$49&NOT$7&AND$47$8&AND$7$8&AND$10$9&AND$40$9&AND$15$9&AND$20$9&AND$25$9&AND$30$9&AND$35$9&AND$45$9"},{name:"7 segments decoder",code:"7 SEG;Q0&Q1&Q2&Q3;T$19&TR$28&BR$35&B$45&BL$49&TL$55&M$61;AND$3$36&AND$4$39&AND$0$2&AND$6$40&AND$0$1&AND$8$39&AND$34$39&AND$10$40&AND$2$36&AND$12$40&AND$2$36&AND$14$40&OR$7$17&AND$1$18&OR$2$40&OR$16$22&OR$3$39&AND$20$34&OR$21$5&XNOR$0$1&AND$23$40&AND$0$3&OR$24$27&AND$25$36&OR$26$30&OR$34$40&AND$29$39&XOR$2$3&OR$31$33&AND$0$40&NOT$0&OR$32$37&NOT$1&AND$36$38&OR$0$40&NOT$2&NOT$3&XOR$0$1&AND$41$2&AND$3$36&OR$42$9&OR$44$46&OR$43$11&OR$1$2&AND$47$3&OR$48$50&AND$34$51&OR$1$39&OR$1$39&AND$52$3&OR$53$13&OR$54$57&OR$2$36&AND$56$34&OR$0$39&AND$58$3&OR$59$15&OR$60$62&AND$1$63&OR$34$39"},{name:"Merge",code:"MERGE;A0&A1&A2&A3&A4&A5&A6&A7&B0&B1&B2&B3&B4&B5&B6&B7;O0$16&O1$17&O2$18&O3$19&O4$20&O5$21&O6$22&O7$23;OR$0$8&OR$1$9&OR$2$10&OR$3$11&OR$4$12&OR$5$13&OR$6$14&OR$7$15"},{name:"Adder",code:"ADD;A&B&Cin;R$4&Cout$6;XOR$0$1&XOR$3$2&AND$0$1&OR$5$7&AND$3$2"},{name:"SR latch",code:"SR;R&S;Q$2&/Q$3;NOR$0$3&NOR$2$1"},{name:"JK flip flop",code:"JK;/PRE&J&CLK&K&/CLE;Q$6&/Q$8;AND$0$10&NAND$5$8&AND$6$13&NAND$7$4&AND$4$1&NAND$9$11&AND$2$8&AND$6$2&NAND$12$14&AND$3$0"},{name:"JK (Synchronised on rising edges)",code:"JK RIS;/PRE&J&CLK&K&/CLE;Q$10&/Q$12;AND$2$8&NOT$2&NOT$6&NOT$7&AND$0$14&NAND$9$12&AND$10$17&NAND$11$4&AND$4$1&NAND$13$15&AND$5$12&AND$10$5&NAND$16$18&AND$3$0"},{name:"JK Master-Slave",code:"JK MSTSLV;/PRE&J&CLK&K&/CLE;Q$24&/Q$26;AND$2$8&NOT$2&NOT$6&NOT$7&AND$0$14&NAND$9$12&AND$10$17&NAND$11$4&AND$4$1&NAND$13$15&AND$5$12&AND$10$5&NAND$16$18&AND$3$0&AND$33$22&NOT$33&NOT$20&NOT$21&AND$0$28&NAND$23$26&AND$24$31&NAND$25$4&AND$4$10&NAND$27$29&AND$19$26&AND$24$19&NAND$30$32&AND$12$0&NOT$2"},{name:"Multiplexer",code:"MUX;A&B&S;O$5;AND$0$4&NOT$2&OR$3$6&AND$1$2"},{name:"Multiplexer 4",code:"MUX4;A&B&C&D&S0&S1;O$16;AND$0$7&NOT$4&OR$6$9&AND$1$4&AND$2$11&NOT$4&OR$10$13&AND$3$4&AND$8$15&NOT$5&OR$14$17&AND$12$5"},{name:"Multiplexer 8",code:"MUX8;A&B&C&D&E&F&G&H&S0&S1&S2;O$25;AND$0$12&NOT$8&OR$11$14&AND$1$8&AND$2$16&NOT$8&OR$15$18&AND$3$8&AND$13$20&NOT$9&OR$19$22&AND$17$9&AND$21$24&NOT$10&OR$23$26&AND$37$10&AND$4$28&NOT$8&OR$27$30&AND$5$8&AND$6$32&NOT$8&OR$31$34&AND$7$8&AND$29$36&NOT$9&OR$35$38&AND$33$9"},{name:"Demultiplexer",code:"DEMUX;I&S;A$2&B$4;AND$0$3&NOT$1&AND$0$1"},{name:"Demultiplexer 4",code:"DEMUX4;I&S0&S1;A$6&B$8&C$9&D$11;AND$0$4&NOT$2&AND$0$2&AND$3$7&NOT$1&AND$3$1&AND$5$10&NOT$1&AND$5$1"},{name:"Demultiplexer 8",code:"DEMUX8;I&S0&S1&S2;A$7&B$9&C$10&D$12&E$16&F$18&G$19&H$21;AND$22$5&NOT$2&AND$22$2&AND$4$8&NOT$1&AND$4$1&AND$6$11&NOT$1&AND$6$1&AND$24$14&NOT$2&AND$24$2&AND$13$17&NOT$1&AND$13$1&AND$15$20&NOT$1&AND$15$1&AND$0$23&NOT$3&AND$0$3"},{name:"Rising edge detector",code:"RIS EDGE;I;O$1;AND$0$4&NOT$0&NOT$2&NOT$3"},{name:"Falling edge detector",code:"FAL EDGE;I;O$1;NOR$0$4&NOT$3&NOT$0&NOT$2"}];function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var SerializerParser=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"parseCustomGate",value:function(t){try{var e=function(t,e){for(var i=1;i<e.length;i++)""!==e[i]&&(t.inputs[i-1]=new Connection(t,e[i]<n.maxInputs?n.inputGates[e[i]]:n.internGates[e[i]-n.maxInputs]))},n=new CustomGate;n.type="CUSTOM",n.string=t;for(var i=t.split(";"),r=i[1].split("&").filter(function(t){return""!==t}),o=0;o<r.length;o++){var a=new Gate;a.name=r[o],n.inputGates[o]=a}n.maxInputs=r.length;for(var s=i[2].split("&").filter(function(t){return""!==t}),u=0;u<s.length;u++){var c=s[u].split("$"),l=GateFactory.NODE(0,0);l.name=c[0],l.width=0,n.outputGates[u]=l}for(var h=i[3].split("&").filter(function(t){return""!==t}),f=0;f<h.length;f++){var d=h[f].split("$")[0].split("@"),p=GateFactory[d[0]];n.internGates[f]=p(0,0),n.internGates[f].parseParameters(d)}for(var y=0;y<s.length;y++){var v=s[y].split("$").filter(function(t){return""!==t});e(n.outputGates[y],v)}for(var $=0;$<h.length;$++){var g=h[$].split("$").filter(function(t){return""!==t});e(n.internGates[$],g)}return n.maxOutputs=n.outputGates.length,n.setGraphicProperties(mouseX,mouseY,100,20+20*Math.max(n.maxInputs,n.maxOutputs),"#379f1f",i[0])}catch(e){return console.log((new Date).toJSON()+"\nError while parsing gate data\n"+t+"\n"+e.stack),Popup.close(),void Popup.openError("An error occured while parsing gate data:\n"+t)}}},{key:"serializeCustomGate",value:function(t,e,n){SimulatorState.export(t);var i="";function r(t){var e=!0,n=!1,i=void 0;try{for(var r,o=t.internGates.concat(t.outputGates)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){for(var a=r.value,s=0;s<a.maxInputs;s++)if(void 0!==a.inputs[s]&&null!==a.inputs[s]){var u=t.inputGates.indexOf(a.inputs[s].destination);-1!==u&&(t.inputs[u]?a.inputs[s].destination=t.inputs[u].destination:a.inputs.splice(s,1))}gates.push(a)}}catch(t){n=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw i}}}function o(t,e){i[i.length-1]===t?i=i.substring(0,i.length-1)+e:i+=e}function a(t){for(var n=t instanceof Input,i=n?0:e.length,r=0;r<gates.length;r++){if(gates[r]===t)return i;n?gates[r]instanceof Input&&i++:gates[r]instanceof Output||gates[r]instanceof Input||i++}return-1}for(var s=0;s<gates.length;s++)gates[s]instanceof CustomGate&&r(gates[s]);var u=!0,c=!1,l=void 0;try{for(var h,f=gates[Symbol.iterator]();!(u=(h=f.next()).done);u=!0)for(var d=h.value,p=0;p<d.maxInputs;p++)d.inputs[p]&&(d.inputs[p].destination=d.inputs[p].getInput())}catch(t){c=!0,l=t}finally{try{u||null==f.return||f.return()}finally{if(c)throw l}}gates=(gates=gates.filter(function(t){return!(t instanceof ConnectionNode)})).filter(function(t){return!(t instanceof CustomGate)}).sort(function(t,e){return t.y-e.y}),i=t+";";var y=!0,v=!1,$=void 0;try{for(var g,O=e[Symbol.iterator]();!(y=(g=O.next()).done);y=!0){var m=g.value;i+=m+"&"}}catch(t){v=!0,$=t}finally{try{y||null==O.return||O.return()}finally{if(v)throw $}}o("&",";");var P=0,b=!0,w=!1,x=void 0;try{for(var C,_=gates[Symbol.iterator]();!(b=(C=_.next()).done);b=!0){var N=C.value;if(N instanceof Output){i+=n[P]+"$";var T=!0,k=!1,A=void 0;try{for(var I,G=N.inputs[Symbol.iterator]();!(T=(I=G.next()).done);T=!0){var D=I.value;i+=(D?a(D.destination):"NULL")+"$"}}catch(t){k=!0,A=t}finally{try{T||null==G.return||G.return()}finally{if(k)throw A}}P++,o("$","&")}}}catch(t){w=!0,x=t}finally{try{b||null==_.return||_.return()}finally{if(w)throw x}}o("&",";");var S=!0,R=!1,B=void 0;try{for(var E,M=gates[Symbol.iterator]();!(S=(E=M.next()).done);S=!0){var U=E.value;if(!(U instanceof Output||U instanceof Input)){i+=U.type+U.serializeParameters()+"$";var F=!0,j=!1,L=void 0;try{for(var X,z=U.inputs[Symbol.iterator]();!(F=(X=z.next()).done);F=!0){var Y=X.value;i+=(Y?a(Y.destination):"NULL")+"$"}}catch(t){j=!0,L=t}finally{try{F||null==z.return||z.return()}finally{if(j)throw L}}P++,o("$","&")}}}catch(t){R=!0,B=t}finally{try{S||null==M.return||M.return()}finally{if(R)throw B}}return o("&",""),gates=[],i}}]),t}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var SimulatorState=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"export",value:function(t){var e={gates:[],interfaceZoomFactor:Interface.zoomFactor,origin:Interface.origin},n=!0,i=!1,r=void 0;try{for(var o,a=gates[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,u=s.createSave();u.inputs=s.inputs.map(function(t){if(null==t)return null;var e=t.destination;if(e instanceof ConnectionNode){var n=e.findParentCustomGate();if(null!==n)return[n.gate.id,n.outputIndex]}return[e.id]}),e.gates.push(u)}}catch(t){i=!0,r=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}Tools.download(JSON.stringify(e),(t||"LogicGateSimulator")+".lgs")}},{key:"askForImport",value:function(){var e=window.document.createElement("INPUT");e.accept=".lgs",e.type="file",e.click(),e.addEventListener("change",function(){e.files[0]&&e.files[0].text().then(t.import)})}},{key:"import",value:function(t){try{var e=function(t,e){var n=r.find(function(e){return e.id===t});return void 0===e?n:n.outputGates[e]},n=JSON.parse(t);if(0===n.gates.length)return;var i=Gate.nextID,r=n.gates.map(function(t){var e;if("CUSTOM"===t.type){if(!(e=SerializerParser.parseCustomGate(t.string)))return}else e=(0,GateFactory[t.type])(0,0);return Object.assign(e,t),e.id+=i,e.x*=Interface.zoomFactor/n.interfaceZoomFactor,e.y*=Interface.zoomFactor/n.interfaceZoomFactor,e}),o=r.reduce(function(t,e){return t+e.x},0)/r.length,a=r.reduce(function(t,e){return t+e.y},0)/r.length;if(n.origin){n.origin[0]*=Interface.zoomFactor/n.interfaceZoomFactor,n.origin[1]*=Interface.zoomFactor/n.interfaceZoomFactor,n.origin[0]+=canvas.width/2-o,n.origin[1]+=canvas.height/2-a;var s=Interface.getSnappedPosition(n.origin[0],n.origin[1]);o-=s[0]-n.origin[0],a-=s[1]-n.origin[1]}var u=!0,c=!1,l=void 0;try{for(var h,f=r[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var d=h.value;d.x+=canvas.width/2-o,d.y+=canvas.height/2-a}}catch(t){c=!0,l=t}finally{try{u||null==f.return||f.return()}finally{if(c)throw l}}var p=!0,y=!1,v=void 0;try{for(var $,g=r[Symbol.iterator]();!(p=($=g.next()).done);p=!0){var O=$.value,m=O.inputs;O.inputs=[];for(var P=0;P<m.length;P++)if(null!==m[P]){var b=e(m[P][0]+i,m[P][1]);O.inputs[P]=new Connection(O,b)}}}catch(t){y=!0,v=t}finally{try{p||null==g.return||g.return()}finally{if(y)throw v}}gates=gates.concat(r);var w=!0,x=!1,C=void 0;try{for(var _,N=gates[Symbol.iterator]();!(w=(_=N.next()).done);w=!0){var T=_.value;Gate.nextID=Math.max(Gate.nextID,T.id)}}catch(t){x=!0,C=t}finally{try{w||null==N.return||N.return()}finally{if(x)throw C}}Gate.nextID++}catch(t){console.log((new Date).toJSON()+"\nError while parsing save data\n"+t.stack),Popup.close(),Popup.openError("An error occured while parsing save data")}}}]),t}();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=_superPropBase(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Clock=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).period=50,t.current=0,t}return _inherits(e,Gate),_createClass(e,[{key:"update",value:function(){this.current--,this.current<0&&(this.current=this.period,this.output=!this.output)}},{key:"onClick",value:function(){Popup.open(),Popup.addTitle("Clock configuration"),Popup.addSpace(),Popup.addFields([{id:"clockPeriod",defaultValue:this.period}],"Period (milliseconds):"),Popup.addFields([{id:"clockCurrent",defaultValue:this.current}],"Current (milliseconds):"),Popup.addDoneButton(e.chooseParameters),e.openedPopup=this}},{key:"setPeriod",value:function(t,e){return this.period=t,e&&(this.current=e),this}},{key:"serializeParameters",value:function(){return"@".concat(this.period,"@").concat(this.current)}},{key:"parseParameters",value:function(t){this.period=t[1],this.current=t[2]}},{key:"createSave",value:function(){var t=_get(_getPrototypeOf(e.prototype),"createSave",this).call(this);return t.period=this.period,t.current=this.current,t}}],[{key:"chooseParameters",value:function(){var t=document.getElementById("clockPeriod").value;isNaN(t)||(e.openedPopup.period=t);var n=document.getElementById("clockCurrent").value;isNaN(n)||(e.openedPopup.current=n),Popup.close()}}]),e}();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=_superPropBase(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}_defineProperty(Clock,"openedPopup",void 0);var ConnectionNode=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).upColor="#ffbf00",t.downColor="#7a7a7a",t}return _inherits(e,Gate),_createClass(e,[{key:"tickEnd",value:function(){_get(_getPrototypeOf(e.prototype),"tickEnd",this).call(this),this.color=this.output?this.upColor:this.downColor}},{key:"findParentCustomGate",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=gates[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;if(o instanceof CustomGate)for(var a=0;a<o.outputGates.length;a++)if(o.outputGates[a]===this)return{gate:o,outputIndex:a}}}catch(t){e=!0,n=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}return null}}]),e}();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=_superPropBase(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var CustomGate=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).internGates=[],t.inputGates=[],t.outputGates=[],t.string="",t}return _inherits(e,Gate),_createClass(e,[{key:"update",value:function(){for(var t=0;t<this.inputGates.length;t++)this.inputGates[t].output=void 0!==this.inputs[t]&&this.inputs[t].getValue();var e=!0,n=!1,i=void 0;try{for(var r,o=this.internGates[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.update()}}catch(t){n=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw i}}}},{key:"tickEnd",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.internGates[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){i.value.tickEnd()}}catch(t){e=!0,n=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}}},{key:"getGateForOutput",value:function(t){return this.outputGates[t]}},{key:"onClick",value:function(){Popup.open(),Popup.addTitle("Custom Gate Information"),Popup.addSpace(),Popup.addText(this.string),Popup.addDoneButton(Popup.close)}},{key:"createSave",value:function(){var t=_get(_getPrototypeOf(e.prototype),"createSave",this).call(this);return t.string=this.string,t.maxInputs=this.maxInputs,t}},{key:"draw",value:function(){for(var t=0;t<this.outputGates.length;t++){var n=this.getOutputPosition(t);this.outputGates[t].x=n[0],this.outputGates[t].y=n[1]}_get(_getPrototypeOf(e.prototype),"draw",this).call(this),ctx.fillStyle="#ffffff",ctx.textAlign="center",ctx.textBaseline="middle",ctx.font=.8*this.fontSize+"px Arial";for(var i=0;i<this.outputGates.length;i++){var r=this.getOutputPosition(i);ctx.fillText(this.outputGates[i].name,r[0]-this.width/10,r[1])}for(var o=0;o<this.inputGates.length;o++){var a=this.getInputPosition(o);ctx.fillText(this.inputGates[o].name,a[0]+this.width/10,a[1])}}},{key:"getOutputPosition",value:function(t){return[this.x+this.width/2-Interface.connectionWidth,this.y-this.height/2+this.height*(t+1)/(this.maxOutputs+1)]}}],[{key:"openPopup",value:function(){Popup.open();var t=0,e=0,n=!0,i=!1,r=void 0;try{for(var o,a=gates[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;s instanceof Input&&t++,s instanceof Output&&e++}}catch(t){i=!0,r=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}Popup.addTitle("Custom Gate Configuration"),Popup.addSpace(),Popup.addFields([{id:"name"}],"Gate name"),Popup.addSpace();for(var u=[],c=0;c<t;c++)u.push({id:"input"+c});Popup.addText("Input names: "),u.length>0&&Popup.addFields(u," "),Popup.addSpace();for(var l=[],h=0;h<e;h++)l.push({id:"output"+h});Popup.addText("Output names: "),u.length>0&&Popup.addFields(l," "),Popup.addSpace(),Popup.addDoneButton(function(){for(var n=[],i=0;i<t;i++)n[i]=document.getElementById("input"+i).value;for(var r=[],o=0;o<e;o++)r[o]=document.getElementById("output"+o).value;var a=SerializerParser.parseCustomGate(SerializerParser.serializeCustomGate(document.getElementById("name").value,n,r));BuildMode.addGate(a,!1),Popup.close(),a.onClick(),BuildMode.lastCustomGate=a.string})}}]),e}();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=_superPropBase(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Input=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).upColor="#ffbf00",t.downColor="#7a7a7a",t.isOn=!0,t}return _inherits(e,Gate),_createClass(e,[{key:"update",value:function(){this.output=this.isOn}},{key:"onClick",value:function(){this.isOn=!this.isOn}},{key:"createSave",value:function(){var t=_get(_getPrototypeOf(e.prototype),"createSave",this).call(this);return t.isOn=this.isOn,t}},{key:"drawBody",value:function(){_get(_getPrototypeOf(e.prototype),"drawBody",this).call(this),ctx.fillStyle=this.isOn?this.upColor:this.downColor,ctx.fillRect(this.x-this.width/2+this.width/8,this.y-this.height/2+this.height/8,this.width-2*this.width/8,this.height-2*this.height/8)}}]),e}();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=_superPropBase(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Output=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).upColor="#ffbf00",t.downColor="#7a7a7a",t.maxOutputs=0,t}return _inherits(e,Gate),_createClass(e,[{key:"tickEnd",value:function(){_get(_getPrototypeOf(e.prototype),"tickEnd",this).call(this),this.color=this.output?this.upColor:this.downColor}}]),e}();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=_superPropBase(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Switch=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).isOn=!0,t}return _inherits(e,Gate),_createClass(e,[{key:"update",value:function(){this.isOn?_get(_getPrototypeOf(e.prototype),"update",this).call(this):this.output=!1}},{key:"onClick",value:function(){this.isOn=!this.isOn}},{key:"serializeParameters",value:function(){return"@"+(this.isOn?"1":"0")}},{key:"parseParameters",value:function(t){this.isOn="1"===t[1]}},{key:"createSave",value:function(){var t=_get(_getPrototypeOf(e.prototype),"createSave",this).call(this);return t.isOn=this.isOn,t}},{key:"drawBody",value:function(){_get(_getPrototypeOf(e.prototype),"drawBody",this).call(this),this.isOn||(ctx.fillStyle=Interface.BACKGROUND_COLOR,ctx.fillRect(this.x-this.width/2+this.width/5,this.y-this.height/2,this.width-2*this.width/5,this.height))}}]),e}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var Button=function(){function t(){_classCallCheck(this,t),this.x=0,this.y=0,this.width=80,this.height=50,this.name="",this.color="#000000",this.fontSize=14}return _createClass(t,[{key:"setOnClick",value:function(t){return this.onClick=t,this}},{key:"onClick",value:function(){}},{key:"setGraphicProperties",value:function(t,e,n,i){return this.width=t,this.height=e,this.name=n,this.color=i,this}},{key:"draw",value:function(){ctx.fillStyle=this.color,ctx.fillRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height),ctx.fillStyle=Interface.BACKGROUND_COLOR,ctx.fillRect(this.x-this.width/2+this.width/15,this.y-this.height/2+this.height/15,this.width-2*this.width/15,this.height-2*this.height/15),this.drawCenter()}},{key:"drawCenter",value:function(){this.drawName()}},{key:"drawName",value:function(){ctx.fillStyle="#ffffff",ctx.textAlign="center",ctx.textBaseline="middle",ctx.font=this.fontSize+"px Arial",ctx.fillText(this.name,this.x,this.y)}}]),t}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Interface=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"clear",value:function(){ctx.fillStyle=t.BACKGROUND_COLOR,ctx.fillRect(0,0,canvas.width,canvas.height)}},{key:"draw",value:function(){t.getCurrentMode().lateUpdate(),t.buttons[0].color=0===t.mode?"#ffeb47":"#ffffff",t.buttons[1].color=1===t.mode?"#ffeb47":"#ffffff",t.buttons[2].color=2===t.mode?"#ffeb47":"#ffffff",t.buttons[0].x=canvas.width/2-t.buttons[0].width-t.BUTTON_SPACING,t.buttons[0].y=t.buttons[0].height/2+t.BUTTON_SPACING,t.buttons[1].x=canvas.width/2,t.buttons[1].y=t.buttons[0].height/2+t.BUTTON_SPACING,t.buttons[2].x=canvas.width/2+t.buttons[0].width+t.BUTTON_SPACING,t.buttons[2].y=t.buttons[0].height/2+t.BUTTON_SPACING,t.buttons[0].draw(),t.buttons[1].draw(),t.buttons[2].draw(),t.buttons[3].x=.5*t.buttons[3].width+t.BUTTON_SPACING,t.buttons[3].y=.5*t.buttons[3].height+t.BUTTON_SPACING,t.buttons[4].x=1.5*t.buttons[3].width+2*t.BUTTON_SPACING,t.buttons[4].y=.5*t.buttons[3].height+t.BUTTON_SPACING,t.buttons[3].draw(),t.buttons[4].draw(),t.buttons[5].x=.5*t.buttons[5].width+t.BUTTON_SPACING,t.buttons[5].y=.5*t.buttons[5].height+t.buttons[3].height+2*t.BUTTON_SPACING,t.buttons[5].draw(),0===framesToCalculate?(t.buttons[6].x=1.5*t.buttons[6].width+2*t.BUTTON_SPACING,t.buttons[6].y=.5*t.buttons[6].height+t.buttons[4].height+2*t.BUTTON_SPACING,t.buttons[6].draw()):(t.buttons[6].x=-1e3,t.buttons[6].y=-1e3)}},{key:"getButtonAtPosition",value:function(e,n){var i=!0,r=!1,o=void 0;try{for(var a,s=t.getCurrentMode().buttons.concat(t.buttons)[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var u=a.value;if(Math.abs(e-u.x)<u.width/2&&Math.abs(n-u.y)<u.height/2)return u}}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return null}},{key:"init",value:function(){t.origin=[0,0],t.zoomFactor=1,t.mode=0,t.blockInputs=!1,t.negCircleR=5,t.connectionGap=20,t.connectionWidth=3,BuildMode.init(),WiringMode.init(),InteractionMode.init(),t.buttons=[(new Button).setGraphicProperties(90,30,"Build","#ffffff").setOnClick(function(){return BuildMode.enable()}),(new Button).setGraphicProperties(90,30,"Wiring","#ffffff").setOnClick(function(){return WiringMode.enable()}),(new Button).setGraphicProperties(90,30,"Interaction","#ffffff").setOnClick(function(){return InteractionMode.enable()}),(new Button).setGraphicProperties(70,40,"Import","#00e1ff").setOnClick(function(){return SimulatorState.askForImport()}),(new Button).setGraphicProperties(70,40,"Export","#00e1ff").setOnClick(function(){return SimulatorState.export()}),(new Button).setGraphicProperties(30,30,"","#ff9100").setOnClick(function(){return framesToCalculate=-!framesToCalculate}),(new Button).setGraphicProperties(30,30,"","#ff9100").setOnClick(function(){framesToCalculate>=0&&framesToCalculate++})],t.buttons[5].drawCenter=function(){ctx.beginPath(),0===framesToCalculate?(ctx.moveTo(this.x-this.width/4,this.y-this.height/4),ctx.lineTo(this.x-this.width/4,this.y+this.height/4),ctx.lineTo(this.x+this.width/4,this.y)):(ctx.moveTo(this.x-this.width/10+this.width/6,this.y+this.height/4),ctx.lineTo(this.x-this.width/10+this.width/6,this.y-this.height/4),ctx.lineTo(this.x+this.width/10+this.width/6,this.y-this.height/4),ctx.lineTo(this.x+this.width/10+this.width/6,this.y+this.height/4),ctx.moveTo(this.x-this.width/10-this.width/6,this.y+this.height/4),ctx.lineTo(this.x-this.width/10-this.width/6,this.y-this.height/4),ctx.lineTo(this.x+this.width/10-this.width/6,this.y-this.height/4),ctx.lineTo(this.x+this.width/10-this.width/6,this.y+this.height/4)),ctx.fillStyle="#ff9100",ctx.fill()},t.buttons[6].drawCenter=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/20-this.width/6,this.y+this.height/4),ctx.lineTo(this.x-this.width/20-this.width/6,this.y-this.height/4),ctx.lineTo(this.x+this.width/20-this.width/6,this.y-this.height/4),ctx.lineTo(this.x+this.width/20-this.width/6,this.y+this.height/4),ctx.moveTo(this.x,this.y-this.height/4),ctx.lineTo(this.x,this.y+this.height/4),ctx.lineTo(this.x+this.width/4,this.y),ctx.fillStyle="#ff9100",ctx.fill()}}},{key:"update",value:function(){t.getCurrentMode().earlyUpdate(),rightArrowPressed&&framesToCalculate>=0&&(framesToCalculate=Math.max(framesToCalculate,1))}},{key:"getCurrentMode",value:function(){switch(t.mode){case 0:return BuildMode;case 1:return WiringMode;case 2:return InteractionMode}}},{key:"zoom",value:function(e){t.zoomFactor*=e,t.negCircleR*=e,t.connectionWidth*=e,t.connectionGap*=e,t.origin[0]=(t.origin[0]-mouseX)*e+mouseX,t.origin[1]=(t.origin[1]-mouseY)*e+mouseY;var n=!0,i=!1,r=void 0;try{for(var o,a=gates[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;s.width*=e,s.height*=e,s.x=(s.x-mouseX)*e+mouseX,s.y=(s.y-mouseY)*e+mouseY,s.fontSize*=e}}catch(t){i=!0,r=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}}},{key:"getSnappedPosition",value:function(e,n){return e=(e-t.origin[0])/t.zoomFactor,n=(n-t.origin[1])/t.zoomFactor,e=t.GATE_SNAP_DIV_SIZE*Math.round(e/t.GATE_SNAP_DIV_SIZE),n=t.GATE_SNAP_DIV_SIZE*Math.round(n/t.GATE_SNAP_DIV_SIZE),[e=e*t.zoomFactor+t.origin[0],n=n*t.zoomFactor+t.origin[1]]}}]),t}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}_defineProperty(Interface,"BACKGROUND_COLOR","#353535"),_defineProperty(Interface,"BUTTON_SPACING",5),_defineProperty(Interface,"GATE_SNAP_DIV_SIZE",10),_defineProperty(Interface,"zoomFactor",void 0),_defineProperty(Interface,"mode",void 0),_defineProperty(Interface,"blockInputs",void 0),_defineProperty(Interface,"buttons",void 0),_defineProperty(Interface,"origin",void 0),_defineProperty(Interface,"negCircleR",void 0),_defineProperty(Interface,"connectionWidth",void 0),_defineProperty(Interface,"connectionGap",void 0);var BuildMode=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"init",value:function(){t.GATES_LIBRARY=gatesLibrary,t.buttons=[(new Button).setGraphicProperties(80,50,"Destroy","#ae110b").setOnClick(function(){return t.removeGate(t.selectedGate)}),(new Button).setGraphicProperties(80,30,"UP","#379f1f").setOnClick(function(){return t.selectorPosition=Math.max(0,t.selectorPosition-1)}),(new Button).setGraphicProperties(80,30,"DOWN","#379f1f").setOnClick(function(){return t.selectorPosition=Math.min(t.buttons.length-t.listLength-5,t.selectorPosition+1)}),(new Button).setGraphicProperties(150,60,"Create Custom Gate","#379f1f").setOnClick(function(){return CustomGate.openPopup()}),(new Button).setGraphicProperties(150,60,"Last Custom Gate","#379f1f").setOnClick(function(){return t.addGate(SerializerParser.parseCustomGate(t.lastCustomGate))}),(new Button).setGraphicProperties(80,80,"AND","#379f1f").setOnClick(function(){return t.addGate(GateFactory.AND(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"OR","#379f1f").setOnClick(function(){return t.addGate(GateFactory.OR(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"NOT","#379f1f").setOnClick(function(){return t.addGate(GateFactory.NOT(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"XOR","#379f1f").setOnClick(function(){return t.addGate(GateFactory.XOR(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"NOR","#379f1f").setOnClick(function(){return t.addGate(GateFactory.NOR(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"NAND","#379f1f").setOnClick(function(){return t.addGate(GateFactory.NAND(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"XNOR","#379f1f").setOnClick(function(){return t.addGate(GateFactory.XNOR(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"UP","#379f1f").setOnClick(function(){return t.addGate(GateFactory.UP(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"DOWN","#379f1f").setOnClick(function(){return t.addGate(GateFactory.DOWN(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"CLOCK","#379f1f").setOnClick(function(){return t.addGate(GateFactory.CLOCK(mouseX,mouseY,200))}),(new Button).setGraphicProperties(80,80,"INPUT","#379f1f").setOnClick(function(){return t.addGate(GateFactory.INPUT(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"OUTPUT","#379f1f").setOnClick(function(){return t.addGate(GateFactory.OUTPUT(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"SWITCH","#379f1f").setOnClick(function(){return t.addGate(GateFactory.SWITCH(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"NODE","#379f1f").setOnClick(function(){return t.addGate(GateFactory.NODE(mouseX,mouseY))}),(new Button).setGraphicProperties(80,80,"CUSTOM","#379f1f").setOnClick(function(){return t.openCustomGatePopup()})],t.buttons[1].drawCenter=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/8,this.y+this.height/8),ctx.lineTo(this.x+this.width/8,this.y+this.height/8),ctx.lineTo(this.x,this.y-this.height/8),ctx.moveTo(this.x-this.width/8,this.y-this.height/8),ctx.fillStyle="#379f1f",ctx.fill()},t.buttons[2].drawCenter=function(){ctx.beginPath(),ctx.moveTo(this.x-this.width/8,this.y-this.height/8),ctx.lineTo(this.x+this.width/8,this.y-this.height/8),ctx.lineTo(this.x,this.y+this.height/8),ctx.moveTo(this.x-this.width/8,this.y-this.height/8),ctx.fillStyle="#379f1f",ctx.fill()}}},{key:"enable",value:function(){Interface.mode=0,t.selectedGate=null}},{key:"earlyUpdate",value:function(){if(t.selectedGate)if(shiftPressed){var e=Interface.getSnappedPosition(mouseX,mouseY);t.selectedGate.x=e[0],t.selectedGate.y=e[1]}else t.selectedGate.x=mouseX,t.selectedGate.y=mouseY}},{key:"lateUpdate",value:function(){var e=!0,n=!1,i=void 0;try{for(var r,o=t.buttons[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value;a.x=-100,a.y=-100}}catch(t){n=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw i}}t.buttons[0].x=canvas.width-t.buttons[0].width/2-Interface.BUTTON_SPACING,t.buttons[0].y=canvas.height-t.buttons[0].height/2-Interface.BUTTON_SPACING,t.buttons[0].draw(),t.listLength=Math.floor((canvas.height-t.buttons[0].height-2*t.buttons[1].height-5*Interface.BUTTON_SPACING)/(t.buttons[5].height+Interface.BUTTON_SPACING)),t.listLength=Math.min(t.listLength,t.buttons.length-5),t.buttons[1].x=canvas.width-t.buttons[1].width/2-Interface.BUTTON_SPACING,t.buttons[1].y=t.buttons[1].height/2+Interface.BUTTON_SPACING,t.buttons[2].x=canvas.width-t.buttons[2].width/2-Interface.BUTTON_SPACING,t.buttons[2].y=t.buttons[5].height*t.listLength+1.5*t.buttons[1].height+Interface.BUTTON_SPACING*(2+t.listLength),t.buttons[1].draw(),t.buttons[2].draw(),5+t.selectorPosition+t.listLength-1>=t.buttons.length&&(t.selectorPosition=t.buttons.length-t.listLength-5);for(var s=0;s<t.listLength&&!(t.selectorPosition+s+5>t.buttons.length);s++)t.buttons[t.selectorPosition+s+5].x=canvas.width-t.buttons[5].width/2-Interface.BUTTON_SPACING,t.buttons[t.selectorPosition+s+5].y=t.buttons[1].height+(s+.5)*t.buttons[5].height+(s+2)*Interface.BUTTON_SPACING,t.buttons[t.selectorPosition+s+5].draw();t.buttons[3].x=t.buttons[3].width/2+Interface.BUTTON_SPACING,t.buttons[3].y=canvas.height-t.buttons[3].height/2-Interface.BUTTON_SPACING,""!==t.lastCustomGate?(t.buttons[4].x=t.buttons[3].width+t.buttons[4].width/2+2*Interface.BUTTON_SPACING,t.buttons[4].y=canvas.height-t.buttons[4].height/2-Interface.BUTTON_SPACING,t.buttons[4].draw()):(t.buttons[4].x=-100,t.buttons[4].y=-100),t.buttons[3].draw()}},{key:"onClick",value:function(){null!==t.selectedGate?t.selectedGate=null:t.selectedGate=Tools.getGateAtPosition(mouseX,mouseY)}},{key:"onKeyPressed",value:function(e){if("Delete"===e&&t.removeGate(t.selectedGate),"a"===e&&t.addGate(GateFactory.AND(mouseX,mouseY),!1),"o"===e&&t.addGate(GateFactory.OR(mouseX,mouseY),!1),"n"===e&&t.addGate(GateFactory.NOT(mouseX,mouseY),!1),"x"===e&&t.addGate(GateFactory.XOR(mouseX,mouseY),!1)," "===e)if("CUSTOM"===t.lastGate)t.addGate(SerializerParser.parseCustomGate(t.lastCustomGate),!1);else if(""!==t.lastGate){var n=GateFactory[t.lastGate];t.addGate(n(mouseX,mouseY),!1)}}},{key:"openCustomGatePopup",value:function(){Popup.open(),Popup.addTitle("Custom Gate"),Popup.addText("Data for your gate (you can generate it with the Build Custom Gate button)");var e=Popup.addFields([{id:"rawData"}]," ")[1];Popup.addSpace(2),Popup.addText("Gates library:"),Popup.addButtons(t.GATES_LIBRARY.map(function(t){return{clickEvent:function(){e.value=t.code},title:t.name}})," "),Popup.addDoneButton(function(){var e=SerializerParser.parseCustomGate(document.getElementById("rawData").value);e&&(t.addGate(e),t.lastCustomGate=e.string,Popup.close())})}},{key:"addGate",value:function(e,n){(void 0===n||n)&&(t.selectedGate=e),e.id=Gate.nextID,Gate.nextID++,t.lastGate=e.type,gates.push(e)}},{key:"removeGate",value:function(e){if(gates=gates.remove(e),t.selectedGate=null,e instanceof CustomGate){var n=!0,i=!1,r=void 0;try{for(var o,a=e.outputGates[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;Gate.removeAllConnectionsTo(s,gates)}}catch(t){i=!0,r=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}}else Gate.removeAllConnectionsTo(e,gates)}}]),t}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}_defineProperty(BuildMode,"GATES_LIBRARY",void 0),_defineProperty(BuildMode,"selectedGate",null),_defineProperty(BuildMode,"selectorPosition",0),_defineProperty(BuildMode,"listLength",0),_defineProperty(BuildMode,"lastCustomGate",""),_defineProperty(BuildMode,"lastGate",""),_defineProperty(BuildMode,"buttons",void 0);var InteractionMode=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"init",value:function(){t.buttons=[]}},{key:"enable",value:function(){Interface.mode=2}},{key:"earlyUpdate",value:function(){}},{key:"lateUpdate",value:function(){}},{key:"onClick",value:function(){var t=Tools.getGateAtPosition(mouseX,mouseY);t&&t.onClick()}},{key:"onKeyPressed",value:function(t){}}]),t}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}_defineProperty(InteractionMode,"buttons",void 0);var WiringMode=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"init",value:function(){t.buttons=[]}},{key:"enable",value:function(){Interface.mode=1,t.selectedOutput=void 0,t.selectedInput=void 0}},{key:"earlyUpdate",value:function(){if(t.selectedOutput||t.selectedInput){var e=t.selectedInput?t.selectedInput.getInputPosition(t.inputIndex):[t.selectedOutput.x+t.selectedOutput.width/2-Interface.connectionWidth,t.selectedOutput.y],n=t.findClosestConnectionSlot(void 0!==t.selectedOutput),i=void 0!==n?[n.x,n.y]:[mouseX,mouseY];ctx.beginPath(),ctx.strokeStyle="#d3d3d3",ctx.lineWidth=Interface.connectionWidth,ctx.moveTo(e[0],e[1]),ctx.lineTo(i[0],i[1]),ctx.stroke()}}},{key:"lateUpdate",value:function(){if(t.selectedOutput||t.selectedInput){var e=t.findClosestConnectionSlot(void 0!==t.selectedOutput);e&&Tools.fillCircle(e.x,e.y,10*Interface.zoomFactor,"rgba(255, 255, 255, 0.5)",!1)}else{var n=t.findClosestConnectionSlot();n&&Tools.fillCircle(n.x,n.y,10*Interface.zoomFactor,"rgba(255, 255, 255, 0.5)",!1)}}},{key:"onClick",value:function(){t.handleClick()}},{key:"onKeyPressed",value:function(t){}},{key:"findClosestConnectionSlot",value:function(e){var n=void 0,i=1/0;function r(e){var r=Tools.sqr(mouseX-e.x)+Tools.sqr(mouseY-e.y);r<Tools.sqr(t.AUTO_SNAP_RANGE*Interface.zoomFactor)&&r<i&&(i=r,n=e)}var o=!0,a=!1,s=void 0;try{for(var u,c=gates[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var l=u.value;if(void 0===e||e)for(var h=0;h<l.maxInputs;h++){var f=l.getInputPosition(h);r({x:f[0],y:f[1],gate:l,index:h,isInput:!0})}if(void 0===e||!e)for(var d=0;d<l.maxOutputs;d++){var p=l.getOutputPosition(d);r({x:p[0],y:p[1],gate:l,index:d,isInput:!1})}}}catch(t){a=!0,s=t}finally{try{o||null==c.return||c.return()}finally{if(a)throw s}}return n}},{key:"handleClick",value:function(){var e=void 0;t.selectedInput&&(e=!1),t.selectedOutput&&(e=!0);var n=t.findClosestConnectionSlot(e);return n?!t.selectedInput&&!t.selectedOutput&&n.isInput&&n.gate.inputs[n.index]?(t.selectedOutput=n.gate.inputs[n.index].destination,void(n.gate.inputs[n.index]=void 0)):(t.selectedOutput||n.isInput||(t.selectedOutput=n.gate.getGateForOutput(n.index)),!t.selectedInput&&n.isInput&&(t.selectedInput=n.gate,t.inputIndex=n.index),void(t.selectedInput&&t.selectedOutput&&(t.selectedInput.addInput(t.selectedOutput,t.inputIndex),t.selectedOutput=void 0,t.selectedInput=void 0))):(t.selectedOutput=void 0,void(t.selectedInput=void 0))}}]),t}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}_defineProperty(WiringMode,"AUTO_SNAP_RANGE",40),_defineProperty(WiringMode,"selectedOutput",void 0),_defineProperty(WiringMode,"selectedInput",void 0),_defineProperty(WiringMode,"inputIndex",void 0),_defineProperty(WiringMode,"buttons",void 0);var Popup=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"open",value:function(){t.containerDiv=document.createElement("DIV"),t.mainDiv.appendChild(t.containerDiv),popupBackground.style.display="block",Interface.blockInputs=!0}},{key:"close",value:function(){t.containerDiv=void 0;for(var e=t.mainDiv.lastElementChild;e;)t.mainDiv.removeChild(e),e=t.mainDiv.lastElementChild;popupBackground.style.display="none",Interface.blockInputs=!1}},{key:"closeIfClickedOnBackground",value:function(){mouseX>.1*canvas.width&&mouseX<.9*canvas.width&&mouseY>.1*canvas.height&&mouseY<.9*canvas.height||t.close()}},{key:"addFields",value:function(e,n){var i=t.containerDiv,r=[];if(n){var o=document.createElement("P");o.innerHTML=n+" ",o.classList.add("popupElementTitle"),t.containerDiv.appendChild(o),i=o,r.push(o)}var a=!0,s=!1,u=void 0;try{for(var c,l=e[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var h=c.value,f=document.createElement("INPUT");h.id&&(f.id=h.id),f.value=h.defaultValue||"",f.classList.add("popupInput"),i.appendChild(f),r.push(f)}}catch(t){s=!0,u=t}finally{try{a||null==l.return||l.return()}finally{if(s)throw u}}return r}},{key:"addButtons",value:function(e,n){var i=t.containerDiv,r=[];if(n){var o=document.createElement("P");o.innerHTML=n,o.classList.add("popupElementTitle"),t.containerDiv.appendChild(o),i=o,r.push(o)}var a=!0,s=!1,u=void 0;try{for(var c,l=e[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var h=c.value,f=document.createElement("BUTTON");f.innerHTML=h.title,f.addEventListener("click",h.clickEvent),f.classList.add("popupButton"),i.appendChild(f),r.push(f)}}catch(t){s=!0,u=t}finally{try{a||null==l.return||l.return()}finally{if(s)throw u}}return r}},{key:"addDoneButton",value:function(e){var n=document.createElement("BUTTON");return n.innerHTML="Done",n.addEventListener("click",e||t.close),n.classList.add("popupDoneButton"),t.containerDiv.appendChild(n),n}},{key:"addTitle",value:function(e){var n=document.createElement("HR");return n.innerHTML=e,n.classList.add("popupTitle"),t.containerDiv.appendChild(n),n}},{key:"addSpace",value:function(e){void 0===e&&(e=1);for(var n=[],i=0;i<e;i++)n.push(t.addText("<br>"));return n}},{key:"addText",value:function(e){var n=document.createElement("P");return n.innerHTML=e,n.classList.add("popupText"),t.containerDiv.appendChild(n),n}},{key:"openError",value:function(e){t.open(),t.addTitle("Error"),t.addSpace(),t.addText(e),t.addDoneButton()}}]),t}();_defineProperty(Popup,"mainDiv",document.getElementById("popup_main_div")),_defineProperty(Popup,"containerDiv",void 0);var mouseX=0,mouseY=0;document.addEventListener("mousemove",function(t){mouseX=t.clientX-canvas.offsetLeft,mouseY=t.clientY-canvas.offsetTop}),document.addEventListener("click",function(){if(!Interface.blockInputs){var t=Interface.getButtonAtPosition(mouseX,mouseY);t?t.onClick():Interface.getCurrentMode().onClick()}}),document.addEventListener("touchstart",function(t){mouseX=t.changedTouches[0].pageX,mouseY=t.changedTouches[0].pageY,document.dispatchEvent(new Event("click"))}),document.addEventListener("touchend",function(t){mouseX=t.changedTouches[0].pageX,mouseY=t.changedTouches[0].pageY,document.dispatchEvent(new Event("click"))}),document.addEventListener("touchmove",function(t){mouseX=t.changedTouches[0].pageX,mouseY=t.changedTouches[0].pageY});var shiftPressed=!1,rightArrowPressed=!1;document.onkeyup=function(t){"Shift"===t.key&&(shiftPressed=!1),"ArrowRight"===t.key&&(rightArrowPressed=!1)},document.onkeydown=function(t){switch(t.key){case"Escape":Popup.close();break;case"Shift":shiftPressed=!0;break;case"ArrowRight":rightArrowPressed=!0}if(!Interface.blockInputs){switch(t.key){case"b":BuildMode.enable();break;case"w":WiringMode.enable();break;case"i":InteractionMode.enable()}Interface.getCurrentMode().onKeyPressed(t.key)}},canvas.addEventListener("wheel",function(t){Interface.blockInputs||Interface.zoom(1-t.deltaY/1e3)});
</script>

</body>
</html>
